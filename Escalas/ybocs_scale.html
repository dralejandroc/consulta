<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Escala Y-BOCS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.06);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
            color: #2d5a5a;
            padding: 30px;
            text-align: center;
        }

        .header h1 { margin: 0; font-size: 2.2em; font-weight: 300; }
        .header p { margin: 10px 0 0; opacity: 0.8; font-size: 1.1em; }

        .card {
            padding: 50px;
            display: none;
            animation: fadeIn 0.5s ease-in;
            min-height: 400px;
        }

        .card.active { display: block; }

        .question-number {
            color: #7fcdcd;
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .question {
            font-size: 1.3em;
            font-weight: 400;
            color: #2d5a5a;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .section-title {
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
            color: #2d5a5a;
            padding: 20px;
            text-align: center;
            font-size: 1.4em;
            font-weight: 500;
            margin: -50px -50px 40px -50px;
            border-radius: 24px 24px 0 0;
        }

        .definition-card {
            background: #f8fffe;
            border: 2px solid #e6f7f1;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .definition-title {
            color: #7fcdcd;
            font-size: 1.6em;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .definition-text {
            color: #2d5a5a;
            font-size: 1.2em;
            line-height: 1.6;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: #f8fffe;
            border: 1px solid #e6f7f1;
            border-radius: 16px;
            padding: 18px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .option:hover {
            background: #e6f7f1;
            border-color: #7fcdcd;
            transform: translateY(-1px);
        }

        .option.selected {
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
            color: #2d5a5a;
            border-color: #7fcdcd;
            transform: translateY(-1px);
        }

        .option-text {
            font-size: 1.1em;
            font-weight: 400;
        }

        .navigation {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-top: 40px;
        }

        .btn-back {
            background: transparent;
            color: #7fcdcd;
            border: 1px solid #e6f7f1;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.7;
        }

        .btn-back:hover {
            opacity: 1;
            background: #f8fffe;
        }

        .btn {
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
            color: #2d5a5a;
            border: none;
            padding: 12px 24px;
            border-radius: 20px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(127, 205, 205, 0.3);
        }

        .progress {
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 30px 25px 30px;
            backdrop-filter: blur(10px);
        }

        .progress-bar {
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            transition: width 0.3s ease;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
        }

        .results {
            text-align: center;
            padding: 40px;
        }

        .score-display {
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdcd 100%);
            color: #2d5a5a;
            padding: 30px;
            border-radius: 20px;
            margin: 20px 0;
        }

        .score-number {
            font-size: 3em;
            font-weight: 300;
            margin-bottom: 10px;
        }

        .subscales {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }

        .subscale {
            flex: 1;
            background: #f8fffe;
            padding: 20px;
            border-radius: 16px;
            border: 1px solid #e6f7f1;
        }

        .subscale-score {
            font-size: 1.8em;
            font-weight: 600;
            color: #7fcdcd;
            margin-bottom: 5px;
        }

        .interpretation {
            background: #f8fffe;
            padding: 25px;
            border-radius: 16px;
            margin: 20px 0;
            border: 1px solid #e6f7f1;
            text-align: left;
        }

        .alert {
            padding: 20px;
            border-radius: 16px;
            margin: 20px 0;
            font-weight: 500;
        }

        .alert-info { background: #e6f7f1; border-left: 4px solid #7fcdcd; color: #2d5a5a; }
        .alert-warning { background: #fff3cd; border-left: 4px solid #ffc107; color: #856404; }

        .export-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .welcome-text {
            text-align: center;
            font-size: 1.2em;
            line-height: 1.6;
            color: #2d5a5a;
            margin-bottom: 30px;
        }

        .medical-access {
            background: #f8fffe;
            border: 2px solid #7fcdcd;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-top: 30px;
        }

        .cutoff-points {
            background: #f8fffe;
            padding: 20px;
            border-radius: 16px;
            margin: 20px 0;
            text-align: left;
            border: 1px solid #e6f7f1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .container { margin: 10px; border-radius: 20px; }
            .card { padding: 30px; min-height: 300px; }
            .header { padding: 20px; }
            .header h1 { font-size: 1.8em; }
            .question { font-size: 1.1em; }
            .option { padding: 15px 20px; }
            .subscales { flex-direction: column; gap: 15px; }
            .export-buttons { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Yale-Brown Obsessive Compulsive Scale (Y-BOCS)</h1>
            <p>Evaluaci√≥n del Trastorno Obsesivo Compulsivo</p>
        </div>

        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <!-- Tarjeta de Bienvenida -->
        <div class="card active" id="card-welcome">
            <h2 style="color: #7fcdcd; text-align: center; margin-bottom: 30px;">Bienvenido/a</h2>
            <div class="welcome-text">
                <p>La siguiente escala eval√∫a s√≠ntomas obsesivo-compulsivos. Por favor, piense en la √∫ltima semana cuando responda las preguntas.</p>
                <p>Responda con sinceridad, no hay respuestas correctas o incorrectas.</p>
                <p>Al final te pedir√° que entregues el dispositivo al M√©dico para su interpretaci√≥n.</p>
            </div>
            <div class="navigation">
                <button class="btn" onclick="nextCard()">Comenzar</button>
            </div>
        </div>

        <!-- Definici√≥n de Obsesiones -->
        <div class="card" id="card-obsessions-def">
            <div class="section-title">Secci√≥n 1: Obsesiones</div>
            <div class="definition-card">
                <div class="definition-title">¬øQu√© son las Obsesiones?</div>
                <div class="definition-text">
                    Las obsesiones son pensamientos frecuentes, indeseados e intrusivos que causan ansiedad o malestar significativo.
                </div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
                <button class="btn" onclick="nextCard()">Continuar</button>
            </div>
        </div>

        <!-- Preguntas de Obsesiones -->
        <div class="card" id="card-1">
            <div class="section-title">Obsesiones</div>
            <div class="question-number">Pregunta 1 de 10</div>
            <div class="question">¬øCu√°nto tiempo le ocupan los pensamientos, dudas patol√≥gicas o im√°genes obsesivas?</div>
            <div class="options">
                <div class="option" data-value="0"><div class="option-text">0 hr/d√≠a</div></div>
                <div class="option" data-value="1"><div class="option-text">0-1 hrs/d√≠a</div></div>
                <div class="option" data-value="2"><div class="option-text">1-3 hrs/d√≠a</div></div>
                <div class="option" data-value="3"><div class="option-text">3-8 hrs/d√≠a</div></div>
                <div class="option" data-value="4"><div class="option-text">‚â• 8 hrs/d√≠a</div></div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <div class="card" id="card-2">
            <div class="section-title">Obsesiones</div>
            <div class="question-number">Pregunta 2 de 10</div>
            <div class="question">¬øCu√°nto interfieren sus pensamientos obsesivos con la actividad social, laboral o funcionamiento?</div>
            <div class="options">
                <div class="option" data-value="0"><div class="option-text">Nada</div></div>
                <div class="option" data-value="1"><div class="option-text">Leve</div></div>
                <div class="option" data-value="2"><div class="option-text">Medio (Manejable)</div></div>
                <div class="option" data-value="3"><div class="option-text">Gran Impedimento</div></div>
                <div class="option" data-value="4"><div class="option-text">Incapacitante</div></div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <div class="card" id="card-3">
            <div class="section-title">Obsesiones</div>
            <div class="question-number">Pregunta 3 de 10</div>
            <div class="question">¬øCu√°nto malestar le causan sus obsesiones?</div>
            <div class="options">
                <div class="option" data-value="0"><div class="option-text">Nada</div></div>
                <div class="option" data-value="1"><div class="option-text">Poco</div></div>
                <div class="option" data-value="2"><div class="option-text">Moderado (Manejable)</div></div>
                <div class="option" data-value="3"><div class="option-text">Severo (Perturbador)</div></div>
                <div class="option" data-value="4"><div class="option-text">Extremo (Incapacitante)</div></div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <div class="card" id="card-4">
            <div class="section-title">Obsesiones</div>
            <div class="question-number">Pregunta 4 de 10</div>
            <div class="question">¬øEs capaz de resistir o desviar las obsesiones?</div>
            <div class="options">
                <div class="option" data-value="0"><div class="option-text">Siempre</div></div>
                <div class="option" data-value="1"><div class="option-text">Mucho</div></div>
                <div class="option" data-value="2"><div class="option-text">Moderado</div></div>
                <div class="option" data-value="3"><div class="option-text">A veces</div></div>
                <div class="option" data-value="4"><div class="option-text">Nunca</div></div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <div class="card" id="card-5">
            <div class="section-title">Obsesiones</div>
            <div class="question-number">Pregunta 5 de 10</div>
            <div class="question">¬øCu√°l es el grado de control que tiene sobre sus obsesiones?</div>
            <div class="options">
                <div class="option" data-value="0"><div class="option-text">Completo</div></div>
                <div class="option" data-value="1"><div class="option-text">Mucho</div></div>
                <div class="option" data-value="2"><div class="option-text">Moderado</div></div>
                <div class="option" data-value="3"><div class="option-text">Poco</div></div>
                <div class="option" data-value="4"><div class="option-text">Ninguno</div></div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <!-- Definici√≥n de Compulsiones -->
        <div class="card" id="card-compulsions-def">
            <div class="section-title">Secci√≥n 2: Compulsiones</div>
            <div class="definition-card">
                <div class="definition-title">¬øQu√© son las Compulsiones?</div>
                <div class="definition-text">
                    Las compulsiones son comportamientos repetitivos o actos mentales que siente una fuerte necesidad de repetir con el objetivo de reducir su ansiedad o prevenir alg√∫n evento temido.
                </div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
                <button class="btn" onclick="nextCard()">Continuar</button>
            </div>
        </div>

        <!-- Preguntas de Compulsiones -->
        <div class="card" id="card-6">
            <div class="section-title">Compulsiones</div>
            <div class="question-number">Pregunta 6 de 10</div>
            <div class="question">¬øCu√°nto tiempo gasta/ocupa en conductas compulsivas o rituales?</div>
            <div class="options">
                <div class="option" data-value="0"><div class="option-text">0 hr/d√≠a</div></div>
                <div class="option" data-value="1"><div class="option-text">0-1 hrs/d√≠a</div></div>
                <div class="option" data-value="2"><div class="option-text">1-3 hrs/d√≠a</div></div>
                <div class="option" data-value="3"><div class="option-text">3-8 hrs/d√≠a</div></div>
                <div class="option" data-value="4"><div class="option-text">‚â• 8 hrs/d√≠a</div></div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <div class="card" id="card-7">
            <div class="section-title">Compulsiones</div>
            <div class="question-number">Pregunta 7 de 10</div>
            <div class="question">¬øCu√°nto interfieren sus conductas compulsivas con la actividad social, laboral o funcionamiento?</div>
            <div class="options">
                <div class="option" data-value="0"><div class="option-text">Nada</div></div>
                <div class="option" data-value="1"><div class="option-text">Leve</div></div>
                <div class="option" data-value="2"><div class="option-text">Medio (Manejable)</div></div>
                <div class="option" data-value="3"><div class="option-text">Gran Impedimento</div></div>
                <div class="option" data-value="4"><div class="option-text">Incapacitantes</div></div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <div class="card" id="card-8">
            <div class="section-title">Compulsiones</div>
            <div class="question-number">Pregunta 8 de 10</div>
            <div class="question">¬øCu√°nto malestar le causar√≠a si tuviera que evitar realizar las compulsiones?</div>
            <div class="options">
                <div class="option" data-value="0"><div class="option-text">Nada</div></div>
                <div class="option" data-value="1"><div class="option-text">Poco</div></div>
                <div class="option" data-value="2"><div class="option-text">Moderado (Manejable)</div></div>
                <div class="option" data-value="3"><div class="option-text">Severo (Perturbador)</div></div>
                <div class="option" data-value="4"><div class="option-text">Extremo (Incapacitante)</div></div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <div class="card" id="card-9">
            <div class="section-title">Compulsiones</div>
            <div class="question-number">Pregunta 9 de 10</div>
            <div class="question">¬øEs capaz de resistir o postergar la realizaci√≥n de compulsiones o rituales?</div>
            <div class="options">
                <div class="option" data-value="0"><div class="option-text">Siempre</div></div>
                <div class="option" data-value="1"><div class="option-text">Mucho</div></div>
                <div class="option" data-value="2"><div class="option-text">Moderado</div></div>
                <div class="option" data-value="3"><div class="option-text">A veces</div></div>
                <div class="option" data-value="4"><div class="option-text">Nunca</div></div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <div class="card" id="card-10">
            <div class="section-title">Compulsiones</div>
            <div class="question-number">Pregunta 10 de 10</div>
            <div class="question">¬øCu√°l es el grado de control que tiene sobre sus conductas compulsivas o rituales?</div>
            <div class="options">
                <div class="option" data-value="0"><div class="option-text">Completo</div></div>
                <div class="option" data-value="1"><div class="option-text">Mucho</div></div>
                <div class="option" data-value="2"><div class="option-text">Moderado</div></div>
                <div class="option" data-value="3"><div class="option-text">Poco</div></div>
                <div class="option" data-value="4"><div class="option-text">Ninguno</div></div>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <!-- Tarjeta de entrega al m√©dico -->
        <div class="card" id="card-handover">
            <h2 style="color: #7fcdcd; text-align: center; margin-bottom: 30px;">Escala finalizada</h2>
            <div class="welcome-text">
                <p><strong>Por favor, pase el dispositivo al M√©dico para su revisi√≥n.</strong></p>
                <p>Gracias por completar la evaluaci√≥n.</p>
            </div>
            <div class="medical-access">
                <p><strong>Acceso exclusivo para el m√©dico:</strong></p>
                <button class="btn" onclick="showResults()">Ver Resultados</button>
            </div>
            <div class="navigation">
                <button class="btn-back" onclick="previousCard()">‚Üê Regresar</button>
            </div>
        </div>

        <!-- Resultados -->
        <div class="card" id="card-results">
            <div class="results">
                <h2 style="color: #7fcdcd; margin-bottom: 30px;">Resultados Y-BOCS</h2>
                
                <div class="score-display">
                    <div class="score-number" id="totalScore">0</div>
                    <div style="font-size: 1.2em;">
                        <span id="totalScoreText">0 / 40</span> puntos
                    </div>
                </div>

                <div class="subscales">
                    <div class="subscale">
                        <div class="subscale-score" id="obsessionScore">0</div>
                        <div>Obsesiones</div>
                        <div style="font-size: 0.9em; color: #7fcdcd; margin-top: 5px;" id="obsessionScoreText">0 / 20</div>
                    </div>
                    <div class="subscale">
                        <div class="subscale-score" id="compulsionScore">0</div>
                        <div>Compulsiones</div>
                        <div style="font-size: 0.9em; color: #7fcdcd; margin-top: 5px;" id="compulsionScoreText">0 / 20</div>
                    </div>
                </div>

                <div class="interpretation" id="interpretation"></div>
                <div id="alertMessage"></div>

                <div class="cutoff-points">
                    <h4 style="color: #7fcdcd; margin-top: 0;">Puntos de corte:</h4>
                    <p><strong>0 ‚Äì 7:</strong> Subcl√≠nico</p>
                    <p><strong>8 ‚Äì 15:</strong> Leve</p>
                    <p><strong>16 ‚Äì 23:</strong> Moderado</p>
                    <p><strong>24 ‚Äì 31:</strong> Severo</p>
                    <p><strong>32 ‚Äì 40:</strong> Muy Severo</p>
                </div>

                <div class="export-buttons">
                    <button class="btn" onclick="saveAsImage()">Guardar como Imagen</button>
                    <button onclick="exportToPDF()">üìÑ Exportar a PDF</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentCard = 0;
        let answers = {};
        const totalQuestions = 10;
        const cardOrder = ['welcome', 'obsessions-def', '1', '2', '3', '4', '5', 'compulsions-def', '6', '7', '8', '9', '10', 'handover', 'results'];

        function updateProgress() {
            const progress = (currentCard / (cardOrder.length - 1)) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function showCard(index) {
            document.querySelectorAll('.card').forEach(card => card.classList.remove('active'));
            document.getElementById(`card-${cardOrder[index]}`).classList.add('active');
            updateProgress();
        }

        function nextCard() {
            if (currentCard < cardOrder.length - 1) {
                currentCard++;
                showCard(currentCard);
            }
        }

        function previousCard() {
            if (currentCard > 0) {
                currentCard--;
                showCard(currentCard);
            }
        }

        // Manejar selecci√≥n de opciones con avance autom√°tico
        document.addEventListener('click', function(e) {
            if (e.target.closest('.option')) {
                const option = e.target.closest('.option');
                const cardId = cardOrder[currentCard];
                const questionNum = parseInt(cardId);
                
                if (!isNaN(questionNum)) {
                    const value = parseInt(option.dataset.value);
                    
                    // Remover selecci√≥n anterior
                    option.parentNode.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
                    
                    // Seleccionar nueva opci√≥n
                    option.classList.add('selected');
                    
                    // Guardar respuesta
                    answers[questionNum] = value;
                    
                    // Avanzar autom√°ticamente despu√©s de un breve delay
                    setTimeout(() => {
                        nextCard();
                    }, 800);
                }
            }
        });

        function calculateResults() {
            const obsessionScore = (answers[1] || 0) + (answers[2] || 0) + (answers[3] || 0) + (answers[4] || 0) + (answers[5] || 0);
            const compulsionScore = (answers[6] || 0) + (answers[7] || 0) + (answers[8] || 0) + (answers[9] || 0) + (answers[10] || 0);
            const totalScore = obsessionScore + compulsionScore;
            
            return { obsessionScore, compulsionScore, totalScore };
        }

        function getInterpretation(score) {
            if (score <= 7) return { level: 'Subcl√≠nico', description: 'Los s√≠ntomas obsesivo-compulsivos est√°n en el rango subcl√≠nico.', severity: 'low' };
            if (score <= 15) return { level: 'Leve', description: 'S√≠ntomas obsesivo-compulsivos de intensidad leve.', severity: 'mild' };
            if (score <= 23) return { level: 'Moderado', description: 'S√≠ntomas obsesivo-compulsivos de intensidad moderada.', severity: 'moderate' };
            if (score <= 31) return { level: 'Severo', description: 'S√≠ntomas obsesivo-compulsivos de intensidad severa.', severity: 'severe' };
            return { level: 'Muy Severo', description: 'S√≠ntomas obsesivo-compulsivos de intensidad muy severa.', severity: 'very-severe' };
        }

        function getHighestScoreItems() {
            const items = [
                { question: 1, label: 'Tiempo ocupado por obsesiones', score: answers[1] || 0 },
                { question: 2, label: 'Interferencia de obsesiones', score: answers[2] || 0 },
                { question: 3, label: 'Malestar por obsesiones', score: answers[3] || 0 },
                { question: 4, label: 'Resistencia a obsesiones', score: answers[4] || 0 },
                { question: 5, label: 'Control sobre obsesiones', score: answers[5] || 0 },
                { question: 6, label: 'Tiempo en compulsiones', score: answers[6] || 0 },
                { question: 7, label: 'Interferencia de compulsiones', score: answers[7] || 0 },
                { question: 8, label: 'Malestar por evitar compulsiones', score: answers[8] || 0 },
                { question: 9, label: 'Resistencia a compulsiones', score: answers[9] || 0 },
                { question: 10, label: 'Control sobre compulsiones', score: answers[10] || 0 }
            ];
            
            // Filtrar items con puntuaci√≥n alta (‚â•3)
            return items.filter(item => item.score >= 3);
        }

        function showResults() {
            currentCard = cardOrder.length - 1;
            showCard(currentCard);
            
            const results = calculateResults();
            const interpretation = getInterpretation(results.totalScore);
            const highScoreItems = getHighestScoreItems();
            
            document.getElementById('totalScore').textContent = results.totalScore;
            document.getElementById('totalScoreText').textContent = `${results.totalScore} / 40`;
            document.getElementById('obsessionScore').textContent = results.obsessionScore;
            document.getElementById('obsessionScoreText').textContent = `${results.obsessionScore} / 20`;
            document.getElementById('compulsionScore').textContent = results.compulsionScore;
            document.getElementById('compulsionScoreText').textContent = `${results.compulsionScore} / 20`;
            
            document.getElementById('interpretation').innerHTML = `
                <h4 style="color: #7fcdcd; margin-top: 0;">Interpretaci√≥n: ${interpretation.level}</h4>
                <p>${interpretation.description}</p>
            `;
            
            // Mostrar alertas basadas en √≠tems con puntuaci√≥n alta
            let alertHTML = '';
            if (highScoreItems.length > 0) {
                alertHTML = `
                    <div class="alert alert-info">
                        <strong>√çtems con puntuaci√≥n elevada (‚â•3):</strong><br>
                        ${highScoreItems.map(item => `‚Ä¢ ${item.label} (${item.score}/4)`).join('<br>')}
                    </div>
                `;
            }
            
            if (interpretation.severity === 'severe' || interpretation.severity === 'very-severe') {
                alertHTML += '<div class="alert alert-warning">Puntuaci√≥n en rango severo. Revisar intervenciones terap√©uticas.</div>';
            }
            
            document.getElementById('alertMessage').innerHTML = alertHTML;
        }

        async function saveAsImage() {
            const resultsCard = document.getElementById('card-results');
            try {
                const canvas = await html2canvas(resultsCard, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false
                });
                
                const link = document.createElement('a');
                link.download = 'resultados-ybocs.png';
                link.href = canvas.toDataURL();
                link.click();
            } catch (error) {
                alert('Error al generar la imagen');
            }
        }

        function exportToPDF() {
    try {
        // Verificar que jsPDF est√© disponible
        if (typeof window.jsPDF === 'undefined') {
            alert('Error: jsPDF no est√° cargado');
            return;
        }

        const { jsPDF } = window.jsPDF;
        const doc = new jsPDF();
        
        // Configuraci√≥n del documento
        const pageWidth = doc.internal.pageSize.getWidth();
        const margin = 20;
        let yPosition = 30;
        
        // T√≠tulo principal
        doc.setFontSize(18);
        doc.setFont("helvetica", "bold");
        doc.text("Resultados de Evaluaci√≥n", margin, yPosition);
        yPosition += 15;
        
        // Fecha y hora
        const fecha = new Date();
        doc.setFontSize(10);
        doc.setFont("helvetica", "normal");
        doc.text(`Fecha: ${fecha.toLocaleDateString('es-MX')} - ${fecha.toLocaleTimeString('es-MX', {hour: '2-digit', minute:'2-digit'})}`, margin, yPosition);
        yPosition += 20;
        
        // Obtener datos del contenedor de resultados
        const resultsContainer = document.getElementById('resultsContainer');
        if (!resultsContainer) {
            alert('No se encontraron resultados para exportar');
            return;
        }
        
        // Procesar cada secci√≥n de resultados
        const sections = resultsContainer.querySelectorAll('.result-section');
        
        sections.forEach((section, index) => {
            // Verificar si necesitamos nueva p√°gina
            if (yPosition > 250) {
                doc.addPage();
                yPosition = 30;
            }
            
            // T√≠tulo de la secci√≥n
            const title = section.querySelector('h3');
            if (title) {
                doc.setFontSize(14);
                doc.setFont("helvetica", "bold");
                doc.text(title.textContent.trim(), margin, yPosition);
                yPosition += 10;
            }
            
            // Puntuaci√≥n
            const score = section.querySelector('.score');
            if (score) {
                doc.setFontSize(12);
                doc.setFont("helvetica", "bold");
                doc.text(`Puntuaci√≥n: ${score.textContent.trim()}`, margin, yPosition);
                yPosition += 8;
            }
            
            // Texto descriptivo
            const paragraphs = section.querySelectorAll('p');
            paragraphs.forEach(p => {
                if (p.textContent.trim() && !p.querySelector('.score')) {
                    doc.setFontSize(10);
                    doc.setFont("helvetica", "normal");
                    
                    // Dividir texto largo en l√≠neas
                    const text = p.textContent.trim();
                    const lines = doc.splitTextToSize(text, pageWidth - (margin * 2));
                    
                    lines.forEach(line => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 30;
                        }
                        doc.text(line, margin, yPosition);
                        yPosition += 5;
                    });
                    yPosition += 3;
                }
            });
            
            // Interpretaciones
            const interpretations = section.querySelectorAll('.interpretation');
            interpretations.forEach(interp => {
                if (yPosition > 260) {
                    doc.addPage();
                    yPosition = 30;
                }
                
                doc.setFontSize(10);
                doc.setFont("helvetica", "italic");
                const text = interp.textContent.trim();
                const lines = doc.splitTextToSize(text, pageWidth - (margin * 2));
                
                lines.forEach(line => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 30;
                    }
                    doc.text(line, margin, yPosition);
                    yPosition += 5;
                });
                yPosition += 8;
            });
            
            yPosition += 5; // Espacio entre secciones
        });
        
        // Pie de p√°gina en todas las p√°ginas
        const totalPages = doc.internal.getNumberOfPages();
        for (let i = 1; i <= totalPages; i++) {
            doc.setPage(i);
            doc.setFontSize(8);
            doc.setFont("helvetica", "normal");
            doc.text(`P√°gina ${i} de ${totalPages}`, pageWidth - 40, doc.internal.pageSize.getHeight() - 10);
            doc.text('Generado autom√°ticamente por el Sistema de Evaluaci√≥n', margin, doc.internal.pageSize.getHeight() - 10);
        }
        
        // Guardar el PDF
        const fileName = `resultados-evaluacion-${fecha.toISOString().split('T')[0]}.pdf`;
        doc.save(fileName);
        
    } catch (error) {
        console.error('Error al generar PDF:', error);
        alert('Error al generar el PDF. Verifica que todos los elementos est√©n cargados.');
    }
}

        // Inicializar
        updateProgress();
    </script>
</body>
</html>
