<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PANSS - Escala de S√≠ntomas Positivos y Negativos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #29A98C 0%, #112F33 100%);
            min-height: 100vh;
            padding: 20px;
            color: #112F33;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .card.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-header {
            background: linear-gradient(135deg, #29A98C, #112F33);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .instructions {
            line-height: 1.6;
            color: #112F33;
            margin-bottom: 20px;
        }

        .instructions h3 {
            color: #29A98C;
            margin: 15px 0 10px 0;
        }

        .instructions ul {
            padding-left: 20px;
            margin: 10px 0;
        }

        .version-selector {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .version-button {
            flex: 1;
            background: linear-gradient(135deg, #29A98C, #112F33);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .version-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 169, 140, 0.3);
        }

        .version-info {
            background: #e8f5f3;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #29A98C;
            font-size: 14px;
        }

        .question-number {
            background: linear-gradient(135deg, #29A98C, #112F33);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 auto 20px auto;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            color: #112F33;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.4;
        }

        .options {
            display: grid;
            gap: 12px;
            margin: 20px 0;
        }

        .option {
            background: #FFF8EE;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .option:hover {
            border-color: #29A98C;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 169, 140, 0.2);
        }

        .option.selected {
            background: linear-gradient(135deg, #29A98C, #112F33);
            color: white;
            border-color: #29A98C;
        }

        .option-number {
            font-weight: bold;
            margin-right: 10px;
        }

        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #29A98C, #112F33);
            transition: width 0.3s ease;
            z-index: 1000;
        }

        .back-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #29A98C, #112F33);
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
            display: none;
        }

        .back-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .back-button.show {
            display: block;
        }

        .results-section {
            margin-top: 30px;
        }

        .score-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #29A98C;
        }

        .score-header {
            font-weight: bold;
            font-size: 18px;
            color: #29A98C;
            margin-bottom: 10px;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #112F33;
        }

        .interpretation {
            background: #e8f5f3;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #29A98C;
        }

        .alert {
            background: #ffeaa7;
            border: 1px solid #fdcb6e;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            color: #2d3436;
        }

        .alert.high {
            background: #ffcccc;
            border-color: #ff6b6b;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .export-button {
            background: linear-gradient(135deg, #29A98C, #112F33);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
        }

        .export-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 169, 140, 0.3);
        }

        .severity-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .severity-normal { background: #48bb78; color: white; }
        .severity-mild { background: #f6ad55; color: white; }
        .severity-moderate { background: #ed8936; color: white; }
        .severity-severe { background: #f56565; color: white; }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
                margin-bottom: 10px;
            }
            
            .export-buttons, .version-selector {
                flex-direction: column;
            }
            
            .export-button, .version-button {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Card 0: Selecci√≥n de Versi√≥n -->
        <div class="card active" id="card-0">
            <div class="card-header">
                Escala PANSS - Instrucciones para el Profesional
            </div>
            <div class="instructions">
                <h3>Informaci√≥n General</h3>
                <p>La Escala de S√≠ntomas Positivos y Negativos (PANSS) es un instrumento dise√±ado para evaluar la severidad de s√≠ntomas en esquizofrenia y otros trastornos psic√≥ticos.</p>
                
                <h3>Aplicaci√≥n de la Escala</h3>
                <ul>
                    <li><strong>Administraci√≥n:</strong> Heteroaplicada por profesional capacitado</li>
                    <li><strong>T√©cnica:</strong> Entrevista semiestructurada</li>
                    <li><strong>Per√≠odo de evaluaci√≥n:</strong> S√≠ntomas de la √∫ltima semana</li>
                </ul>

                <h3>Puntuaci√≥n</h3>
                <p>Cada √≠tem se califica en una escala de 7 puntos:</p>
                <ul>
                    <li>1 = Ausente | 2 = M√≠nimo | 3 = Leve | 4 = Moderado</li>
                    <li>5 = Moderado-severo | 6 = Severo | 7 = Extremo</li>
                </ul>

                <h3>Consideraciones Importantes</h3>
                <ul>
                    <li>Base su evaluaci√≥n en la entrevista cl√≠nica y observaci√≥n del comportamiento</li>
                    <li>Considere tanto la frecuencia como la intensidad de los s√≠ntomas</li>
                    <li>Los resultados no son visibles para el paciente</li>
                    <li>Una reducci√≥n del 20% en el puntaje total indica respuesta al tratamiento</li>
                </ul>

                <h3>Seleccione la Versi√≥n a Aplicar</h3>
                
                <div class="version-info">
                    <strong>Versi√≥n Completa (30 √≠tems)</strong><br>
                    ‚Ä¢ Tiempo: 30-40 minutos<br>
                    ‚Ä¢ Evaluaci√≥n comprehensiva de todos los dominios sintom√°ticos<br>
                    ‚Ä¢ Est√°ndar de oro para evaluaci√≥n cl√≠nica e investigaci√≥n
                </div>

                <div class="version-info">
                    <strong>Versi√≥n Abreviada (19 √≠tems)</strong><br>
                    ‚Ä¢ Tiempo: 15-20 minutos<br>
                    ‚Ä¢ √çtems seleccionados por Teor√≠a de Respuesta a los √çtems<br>
                    ‚Ä¢ Correlaci√≥n alta con versi√≥n completa (r > 0.93)<br>
                    ‚Ä¢ √ötil para seguimiento y monitoreo frecuente
                </div>
            </div>
            
            <div class="version-selector">
                <button class="version-button" onclick="selectVersion('full')">
                    <div style="font-size: 18px; margin-bottom: 8px;">üìã Versi√≥n Completa</div>
                    <div style="font-size: 14px;">30 √≠tems | 30-40 min</div>
                </button>
                <button class="version-button" onclick="selectVersion('brief')">
                    <div style="font-size: 18px; margin-bottom: 8px;">‚ö° Versi√≥n Abreviada</div>
                    <div style="font-size: 14px;">19 √≠tems | 15-20 min</div>
                </button>
            </div>
        </div>

        <!-- Cards din√°micas se generar√°n aqu√≠ -->
        
        <!-- Card de Resultados -->
        <div class="card" id="card-results">
            <div class="card-header">
                Resultados de la Evaluaci√≥n PANSS
            </div>
            <div class="results-section">
                <div class="score-card">
                    <div class="score-header">S√≠ntomas Positivos</div>
                    <div class="score-value" id="positive-score">0</div>
                    <div id="positive-interpretation"></div>
                </div>
                
                <div class="score-card">
                    <div class="score-header">S√≠ntomas Negativos</div>
                    <div class="score-value" id="negative-score">0</div>
                    <div id="negative-interpretation"></div>
                </div>
                
                <div class="score-card">
                    <div class="score-header">Psicopatolog√≠a General</div>
                    <div class="score-value" id="general-score">0</div>
                    <div id="general-interpretation"></div>
                </div>
                
                <div class="score-card">
                    <div class="score-header">Puntuaci√≥n Total PANSS</div>
                    <div class="score-value" id="total-score">0</div>
                    <div id="total-interpretation"></div>
                </div>

                <div class="interpretation">
                    <h3 style="color: #29A98C; margin-bottom: 15px;">Interpretaci√≥n Cl√≠nica</h3>
                    <div id="clinical-interpretation"></div>
                </div>

                <div id="alerts-section"></div>
                
                <div class="export-buttons">
                    <button class="export-button" onclick="exportToPDF()">üìÑ Exportar a PDF</button>
                    <button class="export-button" onclick="exportToImage()">üì∑ Capturar Imagen</button>
                    <button class="export-button" onclick="newEvaluation()">üîÑ Nueva Evaluaci√≥n</button>
                </div>
            </div>
        </div>
    </div>

    <div class="progress-bar" id="progress-bar"></div>
    <button class="back-button" id="back-button" onclick="previousCard()">‚Üê</button>

    <script>
        let currentCard = 0;
        let responses = {};
        let selectedVersion = '';
        let totalQuestions = 30;
        let items = [];

        // Configuraci√≥n de versiones
        const versions = {
            full: {
                name: 'Completa',
                items: 30,
                positiveItems: [1, 2, 3, 4, 5, 6, 7],
                negativeItems: [8, 9, 10, 11, 12, 13, 14],
                generalItems: [15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30],
                positiveRange: { min: 7, max: 49 },
                negativeRange: { min: 7, max: 49 },
                generalRange: { min: 16, max: 112 },
                totalRange: { min: 30, max: 210 }
            },
            brief: {
                name: 'Abreviada',
                items: 19,
                positiveItems: [1, 2, 3, 4, 5, 6], // P1-P6 (excluye P7)
                negativeItems: [8, 9, 10, 11, 13, 14], // N1-N4, N6-N7 (excluye N5)
                generalItems: [18, 20, 21, 22, 23, 27, 28], // G4, G6, G7, G8, G9, G13, G14
                positiveRange: { min: 6, max: 42 },
                negativeRange: { min: 6, max: 42 },
                generalRange: { min: 7, max: 49 },
                totalRange: { min: 19, max: 133 }
            }
        };

        // Definici√≥n de todos los √≠tems PANSS
        const allItems = {
            1: { id: 'P1', name: 'Delirios', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de creencias delirantes',
                2: 'M√≠nimo - Dudosa patolog√≠a; puede estar en el rango superior de lo normal',
                3: 'Leve - Presencia de una o dos creencias delirantes vagas o poco sistematizadas',
                4: 'Moderado - Presencia de un sistema delirante bien organizado pero limitado',
                5: 'Moderado-severo - Presencia de m√∫ltiples delirios bien organizados',
                6: 'Severo - Presencia de sistema delirante estable y elaborado con contenido bizarro',
                7: 'Extremo - Pensamiento dominado por delirios incapacitantes y/o peligrosos'
            }},
            2: { id: 'P2', name: 'Desorganizaci√≥n Conceptual', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de desorganizaci√≥n formal del pensamiento',
                2: 'M√≠nimo - Pensamiento un tanto vago o irrelevante',
                3: 'Leve - Ocasionalmente pierde el hilo o las ideas no est√°n bien relacionadas',
                4: 'Moderado - Pensamiento frecuentemente vago, tangencial o circumstancial',
                5: 'Moderado-severo - Pensamiento generalmente dif√≠cil de seguir',
                6: 'Severo - No hay conexi√≥n l√≥gica entre ideas; habla incoherente',
                7: 'Extremo - Incoherencia severa o mutismo'
            }},
            3: { id: 'P3', name: 'Comportamiento Alucinatorio', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de alucinaciones',
                2: 'M√≠nimo - Dudosa patolog√≠a; puede estar en el rango superior de lo normal',
                3: 'Leve - Una o dos alucinaciones claramente formadas de cualquier tipo',
                4: 'Moderado - Alucinaciones ocasionales o algunas persistentes',
                5: 'Moderado-severo - Alucinaciones persistentes a lo largo del d√≠a',
                6: 'Severo - Alucinaciones presentes casi continuamente',
                7: 'Extremo - Totalmente preocupado por alucinaciones incapacitantes'
            }},
            4: { id: 'P4', name: 'Excitaci√≥n', type: 'positive', descriptions: {
                1: 'Ausente - Comportamiento natural; actividad apropiada',
                2: 'M√≠nimo - Ocasionalmente elevado, animado o impaciente',
                3: 'Leve - Claramente elevado, habla r√°pida, ocasionalmente ruidoso',
                4: 'Moderado - Excitaci√≥n significativa; habla r√°pida e hiperactividad ocasional',
                5: 'Moderado-severo - Marcadamente excitado; habla acelerada, hiperactividad',
                6: 'Severo - Significativamente excitado e hiperactivo; puede ser agresivo',
                7: 'Extremo - Excitaci√≥n extrema; habla acelerada incoherente o hiperactividad'
            }},
            5: { id: 'P5', name: 'Grandiosidad', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de autoestima exagerada',
                2: 'M√≠nimo - Autoestima algo elevada o jactanciosa',
                3: 'Leve - Exagerada autoestima o reclamos sin garant√≠a',
                4: 'Moderado - Marcada grandiosidad con ideas grandiosas superficiales',
                5: 'Moderado-severo - Grandiosidad severa con delirios francos de grandeza',
                6: 'Severo - Pensamiento dominado por delirios grandiosos organizados',
                7: 'Extremo - Grandiosidad extrema con delirios incapacitantes'
            }},
            6: { id: 'P6', name: 'Suspicacia/Persecuci√≥n', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de desconfianza, suspicacia o ideas persecutorias',
                2: 'M√≠nimo - Vaga desconfianza o dudas sobre las motivaciones de otros',
                3: 'Leve - Distintivamente suspicaz; doble sentido en comentarios neutrales',
                4: 'Moderado - Marcadamente suspicaz; ideas de referencia persistentes',
                5: 'Moderado-severo - Marcadas ideas de persecuci√≥n sin delirios claros',
                6: 'Severo - Delirios persecutorios claramente formados pero limitados',
                7: 'Extremo - Delirios persecutorios severos dominan la presentaci√≥n'
            }},
            7: { id: 'P7', name: 'Hostilidad', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de c√≥lera, irritabilidad, resentimiento u hostilidad',
                2: 'M√≠nimo - Indirecta o controlada irritabilidad',
                3: 'Leve - Ocasional irritabilidad y resentimiento',
                4: 'Moderado - Significativa irritabilidad y actitud francamente hostil',
                5: 'Moderado-severo - Marcadamente hostil; frecuente irritabilidad y c√≥lera',
                6: 'Severo - Intensa hostilidad; comportamiento amenazante o agresivo',
                7: 'Extremo - C√≥lera extrema con hostilidad generalizada e incontrolable'
            }},
            8: { id: 'N1', name: 'Embotamiento Afectivo', type: 'negative', descriptions: {
                1: 'Ausente - Rango emocional apropiado y modulado',
                2: 'M√≠nimo - Expresi√≥n emocional ligeramente disminuida',
                3: 'Leve - Rango emocional claramente reducido; expresi√≥n facial infrequente',
                4: 'Moderado - Rango afectivo notablemente reducido',
                5: 'Moderado-severo - Marcada reducci√≥n en expresi√≥n emocional',
                6: 'Severo - Expresi√≥n emocional severamente reducida',
                7: 'Extremo - Virtualmente sin expresi√≥n emocional'
            }},
            9: { id: 'N2', name: 'Retraimiento Emocional', type: 'negative', descriptions: {
                1: 'Ausente - Apropiada participaci√≥n emocional',
                2: 'M√≠nimo - Involucraci√≥n emocional ligeramente reducida',
                3: 'Leve - Ocasionalmente parece indiferente o distante',
                4: 'Moderado - Marcada tendencia a mantenerse emocionalmente separado',
                5: 'Moderado-severo - Claramente distante y retra√≠do emocionalmente',
                6: 'Severo - Marcadamente retra√≠do emocionalmente e inaccesible',
                7: 'Extremo - Aparenta estar totalmente retra√≠do emocionalmente'
            }},
            10: { id: 'N3', name: 'Contacto Pobre', type: 'negative', descriptions: {
                1: 'Ausente - Contacto interpersonal natural y apropiado',
                2: 'M√≠nimo - Contacto interpersonal ligeramente reducido',
                3: 'Leve - Moderada disminuci√≥n en involucramiento o tono',
                4: 'Moderado - Poco natural, forzado o tono superficial',
                5: 'Moderado-severo - Claramente inadecuado, constante falta de involucramiento',
                6: 'Severo - Marcado d√©ficit con m√≠nimo contacto interpersonal',
                7: 'Extremo - Extremo d√©ficit, paciente evita, rechaza o elude contacto'
            }},
            11: { id: 'N4', name: 'Retraimiento Social Pasivo/Ap√°tico', type: 'negative', descriptions: {
                1: 'Ausente - Involucramiento social apropiado',
                2: 'M√≠nimo - Ocasional disminuci√≥n en involucramiento social',
                3: 'Leve - Presente pero mantiene alg√∫n inter√©s en actividades sociales',
                4: 'Moderado - Moderada disminuci√≥n en inter√©s y iniciativa social',
                5: 'Moderado-severo - Marcada falta de involucramiento social',
                6: 'Severo - M√≠nimo inter√©s y pocas actividades sociales',
                7: 'Extremo - Ausencia virtual de involucramiento social'
            }},
            12: { id: 'N5', name: 'Dificultad en el Pensamiento Abstracto', type: 'negative', descriptions: {
                1: 'Ausente - No hay dificultad en el pensamiento abstracto',
                2: 'M√≠nimo - Ocasional dificultad con abstracciones complejas',
                3: 'Leve - Tendencia al pensamiento concreto; dificultad con conceptos',
                4: 'Moderado - Considerablemente abstracto pensamiento concreto, limitado',
                5: 'Moderado-severo - Marcado pensamiento concreto; dificultad con abstracciones',
                6: 'Severo - Pensamiento concret√≠stico; sin conceptos abstractos',
                7: 'Extremo - Pensamiento s√≥lo concreto; comprensi√≥n limitada de palabras simples'
            }},
            13: { id: 'N6', name: 'Ausencia de Espontaneidad y Fluidez en la Conversaci√≥n', type: 'negative', descriptions: {
                1: 'Ausente - Conversaci√≥n natural y fluida',
                2: 'M√≠nimo - Ligera reducci√≥n en espontaneidad de la conversaci√≥n',
                3: 'Leve - Ocasional prompting necesario para mantener conversaci√≥n',
                4: 'Moderado - Marcada reducci√≥n en fluidez; frecuentes prompts necesarios',
                5: 'Moderado-severo - Marcada falta de espontaneidad; respuestas breves',
                6: 'Severo - Pocas respuestas espont√°neas; respuestas limitadas',
                7: 'Extremo - Virtualmente sin espontaneidad; respuestas de una palabra'
            }},
            14: { id: 'N7', name: 'Pensamiento Estereotipado', type: 'negative', descriptions: {
                1: 'Ausente - No hay evidencia de pensamiento estereotipado',
                2: 'M√≠nimo - Ocasional uso de frases repetitivas o ideas clich√©s',
                3: 'Leve - Alguna tendencia a repetici√≥n en temas o perspectivas',
                4: 'Moderado - Marcada tendencia a repetir temas con pensamiento r√≠gido',
                5: 'Moderado-severo - Frecuente repetici√≥n de ideas, frases o palabras',
                6: 'Severo - Pensamiento restringido a pocas ideas estereotipadas',
                7: 'Extremo - Pensamiento limitado a una o dos ideas estereotipadas'
            }},
            15: { id: 'G1', name: 'Preocupaci√≥n Som√°tica', type: 'general', descriptions: {
                1: 'Ausente - No reporta problemas f√≠sicos o de salud',
                2: 'M√≠nimo - Vaga y ocasional preocupaci√≥n por problemas de salud',
                3: 'Leve - Ocasional preocupaci√≥n por problemas de salud o corporales',
                4: 'Moderado - Frecuentes quejas sobre problemas de salud o f√≠sicos',
                5: 'Moderado-severo - Preocupaci√≥n muy frecuente por problemas de salud',
                6: 'Severo - Preocupaci√≥n dominante por problemas de salud',
                7: 'Extremo - Totalmente preocupado por quejas de salud incapacitantes'
            }},
            16: { id: 'G2', name: 'Ansiedad', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de nerviosismo, preocupaci√≥n o inquietud',
                2: 'M√≠nimo - Dudosa evidencia de ansiedad',
                3: 'Leve - Claramente nervioso e inquieto pero puede controlarse',
                4: 'Moderado - Significativa ansiedad; dificultad para controlarla',
                5: 'Moderado-severo - Marcada ansiedad; interfiere significativamente',
                6: 'Severo - Ansiedad severa; dominante en presentaci√≥n cl√≠nica',
                7: 'Extremo - Ansiedad incapacitante; dominante en todas las √°reas'
            }},
            17: { id: 'G3', name: 'Sentimientos de Culpa', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de culpa, verg√ºenza o auto-reproches',
                2: 'M√≠nimo - Vaga o dudosa evidencia de culpa',
                3: 'Leve - Ocasional culpa o auto-reproches por actos menores',
                4: 'Moderado - Frecuentes sentimientos de culpa; preocupaci√≥n por errores pasados',
                5: 'Moderado-severo - Marcados sentimientos de culpa asociados con auto-depreciaci√≥n',
                6: 'Severo - Intensos sentimientos de culpa con ideas delirantes',
                7: 'Extremo - Agobiado por delirios de culpa incapacitantes'
            }},
            18: { id: 'G4', name: 'Tensi√≥n', type: 'general', descriptions: {
                1: 'Ausente - Relajado y calmo',
                2: 'M√≠nimo - Ligeramente tenso; ocasionalmente inquieto',
                3: 'Leve - Moderada tensi√≥n; ocasional inquietud o impaciencia',
                4: 'Moderado - Significativa tensi√≥n; dificultad para relajarse',
                5: 'Moderado-severo - Marcada tensi√≥n; inquietud motora notable',
                6: 'Severo - Tensa al extremo; inquietud prominente',
                7: 'Extremo - Tensi√≥n extrema; inquietud constante e incapacitante'
            }},
            19: { id: 'G5', name: 'Manierismos y Posturas', type: 'general', descriptions: {
                1: 'Ausente - No hay evidencia de movimientos o posturas inusuales',
                2: 'M√≠nimo - Ligera rigidez postural o movimientos inusuales poco frecuentes',
                3: 'Leve - Ocasionales movimientos inusuales o rigidez postural',
                4: 'Moderado - Frecuentes movimientos peculiares o posturas inusuales',
                5: 'Moderado-severo - Marcados manierismos; posturas bizarras ocasionales',
                6: 'Severo - Manierismos frecuentes; posturas bizarras persistentes',
                7: 'Extremo - Comportamiento bizarro constante; posturas catat√≥nicas'
            }},
            20: { id: 'G6', name: 'Depresi√≥n', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de tristeza, desaliento o pesimismo',
                2: 'M√≠nimo - Vagos y raros per√≠odos de tristeza',
                3: 'Leve - Triste pero f√°cilmente animado; s√≥lo superficialmente deprimido',
                4: 'Moderado - Moderadamente deprimido; triste la mayor parte del tiempo',
                5: 'Moderado-severo - Marcadamente deprimido; claramente miserable',
                6: 'Severo - Severamente deprimido; desesperanzado y desalentado',
                7: 'Extremo - Depresi√≥n extrema; miserable constantemente'
            }},
            21: { id: 'G7', name: 'Retardo Motor', type: 'general', descriptions: {
                1: 'Ausente - Actividad motora normal en todo aspecto',
                2: 'M√≠nimo - Ligera pero noticiable disminuci√≥n en velocidad motora',
                3: 'Leve - Claramente ralentizado pero no m√°s que ligero impedimento',
                4: 'Moderado - Moderadamente ralentizado; movimientos definidamente impedidos',
                5: 'Moderado-severo - Marcadamente ralentizado; todas las acciones muy lentas',
                6: 'Severo - Movimientos extremadamente lentos; actividad m√≠nima',
                7: 'Extremo - Virtualmente inm√≥vil; apenas perceptible actividad motora'
            }},
            22: { id: 'G8', name: 'Falta de Cooperaci√≥n', type: 'general', descriptions: {
                1: 'Ausente - Comportamiento natural y cooperativo',
                2: 'M√≠nimo - Excesiva formalidad; cooperaci√≥n ligeramente reluctante',
                3: 'Leve - Alguna evidencia de resentimiento, irritaci√≥n o impaciencia',
                4: 'Moderado - Moderada falta de cooperaci√≥n; respuestas cortas e irritables',
                5: 'Moderado-severo - Marcadamente no cooperativo; responde mal',
                6: 'Severo - Altamente no cooperativo; respuestas hostiles o rechazantes',
                7: 'Extremo - Reh√∫sa completamente cooperar; hostil y agresivo'
            }},
            23: { id: 'G9', name: 'Contenidos Inusuales del Pensamiento', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de pensamiento inusual, extra√±o o bizarro',
                2: 'M√≠nimo - Ligera peculiaridad en contenido del pensamiento',
                3: 'Leve - Ideas claramente extra√±as o contenido del pensamiento inusual',
                4: 'Moderado - Ideas distintivamente inusuales o contenido bizarro del pensamiento',
                5: 'Moderado-severo - Marcadamente bizarro contenido del pensamiento',
                6: 'Severo - Extremadamente bizarro pensamiento con contenido absurdo',
                7: 'Extremo - Pensamiento repleto de ideas absurdas e incoherentes'
            }},
            24: { id: 'G10', name: 'Desorientaci√≥n', type: 'general', descriptions: {
                1: 'Ausente - Totalmente orientado en las tres esferas',
                2: 'M√≠nimo - Ocasional y ligera confusi√≥n sobre el tiempo y lugar',
                3: 'Leve - Moderada confusi√≥n; claramente desorientado en una esfera',
                4: 'Moderado - Significativa confusi√≥n; desorientado en dos esferas',
                5: 'Moderado-severo - Marcada confusi√≥n; severamente desorientado',
                6: 'Severo - Extrema confusi√≥n y desorientaci√≥n en las tres esferas',
                7: 'Extremo - No tiene orientaci√≥n; totalmente confundido'
            }},
            25: { id: 'G11', name: 'Atenci√≥n Deficiente', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de atenci√≥n deficiente',
                2: 'M√≠nimo - Limitada capacidad para enfocar atenci√≥n; f√°cilmente distra√≠ble',
                3: 'Leve - Dificultad para enfocar atenci√≥n; concentraci√≥n pobre',
                4: 'Moderado - S√≥lo puede mantener atenci√≥n brevemente; muy distra√≠ble',
                5: 'Moderado-severo - Marcada dificultad para dirigir o mantener atenci√≥n',
                6: 'Severo - Sin foco sostenido de atenci√≥n; extrema distracci√≥n',
                7: 'Extremo - Sin capacidad dirigida de atenci√≥n; totalmente distra√≠do'
            }},
            26: { id: 'G12', name: 'Ausencia de Juicio e Insight', type: 'general', descriptions: {
                1: 'Ausente - Reconoce enfermedad; comprende necesidad de tratamiento',
                2: 'M√≠nimo - Ligera disminuci√≥n en awareness de enfermedad',
                3: 'Leve - Reconoce enfermedad pero culpa a otros factores externos',
                4: 'Moderado - Insight fluctuante; alg√∫n reconocimiento de enfermedad',
                5: 'Moderado-severo - Deficiente insight; reconoce problemas vagamente',
                6: 'Severo - Sin awareness de enfermedad; niega claramente s√≠ntomas',
                7: 'Extremo - Enf√°ticamente niega enfermedad pasada y presente'
            }},
            27: { id: 'G13', name: 'Perturbaci√≥n de la Volici√≥n', type: 'general', descriptions: {
                1: 'Ausente - Comportamiento natural con voluntad apropiada',
                2: 'M√≠nimo - Ocasional indecisi√≥n en el curso de actividades normales',
                3: 'Leve - Distintas dificultades en procesos de toma de decisiones',
                4: 'Moderado - Disturbed volition; dificultad en iniciar y controlar actividad',
                5: 'Moderado-severo - Marcada ambivalencia; actividad fragmentada',
                6: 'Severo - Fuerte ambivalencia; actividad bloqueada o comportamiento inapropriado',
                7: 'Extremo - Sin control volitivo; incapaz de iniciar o regular actividad'
            }},
            28: { id: 'G14', name: 'Control Deficiente de los Impulsos', type: 'general', descriptions: {
                1: 'Ausente - Impulsos apropiadamente controlados',
                2: 'M√≠nimo - Ocasionales impulsos dif√≠ciles de controlar',
                3: 'Leve - Dificultades en control de impulsos resultan en comportamiento menor',
                4: 'Moderado - Dificultades significativas en control de impulsos',
                5: 'Moderado-severo - Deficiente control de impulsos; episodios impulsivos ocasionales',
                6: 'Severo - Impulsos frecuentemente mal controlados; episodios repetidos',
                7: 'Extremo - Sin control de impulsos; episodios peligrosos constantes'
            }},
            29: { id: 'G15', name: 'Preocupaci√≥n', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de preocupaci√≥n con pensamientos particulares',
                2: 'M√≠nimo - Ocasionalmente absorto en pensamientos; f√°cilmente dirigible',
                3: 'Leve - Frecuentemente preocupado por pensamientos recurrentes',
                4: 'Moderado - Frecuente preocupaci√≥n; dificultad para concentrarse',
                5: 'Moderado-severo - Marcada preocupaci√≥n; interferencia significativa',
                6: 'Severo - Intensamente preocupado; dif√≠cil dirigir hacia otros temas',
                7: 'Extremo - Totalmente absorto; imposible dirigir a otros temas'
            }},
            30: { id: 'G16', name: 'Evitaci√≥n Social Activa', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de evitaci√≥n social',
                2: 'M√≠nimo - Ocasional irritaci√≥n por intrusi√≥n social',
                3: 'Leve - Preferencia por estar solo; evita situaciones sociales',
                4: 'Moderado - Marcada preferencia por actividades solitarias',
                5: 'Moderado-severo - Busca aislamiento; evita activamente actividad social',
                6: 'Severo - Altamente intolerante de situaciones sociales',
                7: 'Extremo - Fuerza aislamiento completo; reh√∫sa interacci√≥n social'
            }}
        };

        function selectVersion(version) {
            selectedVersion = version;
            const config = versions[version];
            totalQuestions = config.items;
            
            // Generar lista de √≠tems para la versi√≥n seleccionada
            items = [];
            
            // A√±adir √≠tems positivos
            config.positiveItems.forEach(itemNum => {
                items.push({ ...allItems[itemNum], originalIndex: itemNum });
            });
            
            // A√±adir √≠tems negativos
            config.negativeItems.forEach(itemNum => {
                items.push({ ...allItems[itemNum], originalIndex: itemNum });
            });
            
            // A√±adir √≠tems generales
            config.generalItems.forEach(itemNum => {
                items.push({ ...allItems[itemNum], originalIndex: itemNum });
            });

            // Generar cards din√°micamente
            generateItemCards();
            
            // Avanzar a la primera pregunta
            currentCard = 1;
            updateDisplay();
        }

        function generateItemCards() {
            const container = document.querySelector('.container');
            
            // Remover cards existentes (excepto la inicial y resultados)
            const existingCards = container.querySelectorAll('.card:not(#card-0):not(#card-results)');
            existingCards.forEach(card => card.remove());

            // Generar nuevas cards
            items.forEach((item, index) => {
                const cardNumber = index + 1;
                const cardHTML = `
                    <div class="card" id="card-${cardNumber}">
                        <div class="question-number">${item.id}</div>
                        <div class="card-header">${item.type === 'positive' ? 'S√≠ntomas Positivos' : 
                                                 item.type === 'negative' ? 'S√≠ntomas Negativos' : 'Psicopatolog√≠a General'}</div>
                        <div class="question-text">${item.name}</div>
                        <div class="options">
                            ${Object.entries(item.descriptions).map(([score, description]) => `
                                <div class="option" onclick="selectOption(${cardNumber}, ${score})">
                                    <span class="option-number">${score}</span>${description}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                // Insertar antes del card de resultados
                const resultsCard = document.getElementById('card-results');
                resultsCard.insertAdjacentHTML('beforebegin', cardHTML);
            });
        }

        function updateDisplay() {
            // Ocultar todas las tarjetas
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('active');
            });

            // Mostrar tarjeta actual
            let currentCardElement;
            if (currentCard === 0) {
                currentCardElement = document.getElementById('card-0');
            } else if (currentCard > totalQuestions) {
                currentCardElement = document.getElementById('card-results');
            } else {
                currentCardElement = document.getElementById(`card-${currentCard}`);
            }
            
            if (currentCardElement) {
                currentCardElement.classList.add('active');
            }

            // Actualizar barra de progreso
            const progress = currentCard === 0 ? 0 : (currentCard / (totalQuestions + 1)) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            // Mostrar/ocultar bot√≥n de regresar
            const backButton = document.getElementById('back-button');
            if (currentCard > 0 && currentCard <= totalQuestions) {
                backButton.classList.add('show');
            } else {
                backButton.classList.remove('show');
            }
        }

        function selectOption(questionNumber, value) {
            const itemIndex = questionNumber - 1;
            const originalIndex = items[itemIndex].originalIndex;
            responses[originalIndex] = value;
            
            // Marcar opci√≥n seleccionada
            const currentCardElement = document.getElementById(`card-${currentCard}`);
            currentCardElement.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');

            // Auto-avance despu√©s de 150ms
            setTimeout(() => {
                nextCard();
            }, 150);
        }

        function nextCard() {
            if (currentCard < totalQuestions) {
                currentCard++;
                updateDisplay();
            } else if (currentCard === totalQuestions) {
                showResults();
            }
        }

        function previousCard() {
            if (currentCard > 1) {
                currentCard--;
                updateDisplay();
            } else if (currentCard === 1) {
                currentCard = 0;
                updateDisplay();
            }
        }

        function calculateScore() {
            const config = versions[selectedVersion];
            let positiveScore = 0;
            let negativeScore = 0;
            let generalScore = 0;

            // Calcular puntuaciones seg√∫n la versi√≥n
            config.positiveItems.forEach(itemIndex => {
                positiveScore += responses[itemIndex] || 1;
            });

            config.negativeItems.forEach(itemIndex => {
                negativeScore += responses[itemIndex] || 1;
            });

            config.generalItems.forEach(itemIndex => {
                generalScore += responses[itemIndex] || 1;
            });

            const totalScore = positiveScore + negativeScore + generalScore;

            return {
                positive: positiveScore,
                negative: negativeScore,
                general: generalScore,
                total: totalScore
            };
        }

        function getInterpretation(scores) {
            const config = versions[selectedVersion];
            
            const interpretations = {
                positive: getSeverityLevel(scores.positive, config.positiveRange.min, config.positiveRange.max),
                negative: getSeverityLevel(scores.negative, config.negativeRange.min, config.negativeRange.max),
                general: getSeverityLevel(scores.general, config.generalRange.min, config.generalRange.max),
                total: getSeverityLevel(scores.total, config.totalRange.min, config.totalRange.max)
            };

            return interpretations;
        }

        function getSeverityLevel(score, minScore, maxScore) {
            const percentage = ((score - minScore) / (maxScore - minScore)) * 100;
            
            if (percentage <= 25) {
                return { level: 'M√≠nimo', class: 'severity-normal', description: 'S√≠ntomas ausentes o m√≠nimos' };
            } else if (percentage <= 50) {
                return { level: 'Leve', class: 'severity-mild', description: 'S√≠ntomas leves presentes' };
            } else if (percentage <= 75) {
                return { level: 'Moderado', class: 'severity-moderate', description: 'S√≠ntomas moderados significativos' };
            } else {
                return { level: 'Severo', class: 'severity-severe', description: 'S√≠ntomas severos prominentes' };
            }
        }

        function showResults() {
            currentCard = totalQuestions + 1;
            const scores = calculateScore();
            const interpretations = getInterpretation(scores);
            const config = versions[selectedVersion];

            // Actualizar puntuaciones
            document.getElementById('positive-score').textContent = `${scores.positive}/${config.positiveRange.max}`;
            document.getElementById('negative-score').textContent = `${scores.negative}/${config.negativeRange.max}`;
            document.getElementById('general-score').textContent = `${scores.general}/${config.generalRange.max}`;
            document.getElementById('total-score').textContent = `${scores.total}/${config.totalRange.max}`;

            // Actualizar interpretaciones
            document.getElementById('positive-interpretation').innerHTML = 
                `<span class="severity-indicator ${interpretations.positive.class}">${interpretations.positive.level}</span> - ${interpretations.positive.description}`;
            
            document.getElementById('negative-interpretation').innerHTML = 
                `<span class="severity-indicator ${interpretations.negative.class}">${interpretations.negative.level}</span> - ${interpretations.negative.description}`;
            
            document.getElementById('general-interpretation').innerHTML = 
                `<span class="severity-indicator ${interpretations.general.class}">${interpretations.general.level}</span> - ${interpretations.general.description}`;
            
            document.getElementById('total-interpretation').innerHTML = 
                `<span class="severity-indicator ${interpretations.total.class}">${interpretations.total.level}</span> - ${interpretations.total.description}`;

            // Interpretaci√≥n cl√≠nica detallada
            const clinicalInterpretation = generateClinicalInterpretation(scores, interpretations);
            document.getElementById('clinical-interpretation').innerHTML = clinicalInterpretation;

            // Generar alertas
            generateAlerts(scores);

            updateDisplay();
        }

        function generateClinicalInterpretation(scores, interpretations) {
            const config = versions[selectedVersion];
            let interpretation = `<strong>Versi√≥n ${config.name} - Perfil Sintomatol√≥gico:</strong><br>`;
            
            // An√°lisis dimensional
            if (scores.positive > scores.negative) {
                interpretation += '‚Ä¢ Predominio de s√≠ntomas positivos. Sugiere presencia de alucinaciones, delirios o desorganizaci√≥n del pensamiento.<br>';
            } else if (scores.negative > scores.positive) {
                interpretation += '‚Ä¢ Predominio de s√≠ntomas negativos. Indica d√©ficits en el funcionamiento emocional, social y cognitivo.<br>';
            } else {
                interpretation += '‚Ä¢ Perfil mixto con s√≠ntomas positivos y negativos equilibrados.<br>';
            }

            // Severidad global
            const totalPercentage = ((scores.total - config.totalRange.min) / (config.totalRange.max - config.totalRange.min)) * 100;
            interpretation += `‚Ä¢ Severidad global: ${totalPercentage.toFixed(1)}% del rango m√°ximo.<br>`;

            // Criterios de respuesta al tratamiento
            interpretation += '<br><strong>Consideraciones para el Tratamiento:</strong><br>';
            
            if (selectedVersion === 'brief') {
                interpretation += '‚Ä¢ Mini-PANSS correlaciona altamente con PANSS-30 (r > 0.93).<br>';
                if (scores.total >= 90) {
                    interpretation += '‚Ä¢ Paciente candidato para intervenci√≥n intensiva.<br>';
                } else if (scores.total >= 60) {
                    interpretation += '‚Ä¢ Requerir√° tratamiento farmacol√≥gico y seguimiento estrecho.<br>';
                } else {
                    interpretation += '‚Ä¢ Puede beneficiarse de intervenciones ambulatorias y psicosociales.<br>';
                }
            } else {
                if (scores.total >= 120) {
                    interpretation += '‚Ä¢ Paciente candidato para intervenci√≥n intensiva y posible hospitalizaci√≥n.<br>';
                } else if (scores.total >= 90) {
                    interpretation += '‚Ä¢ Requerir√° tratamiento farmacol√≥gico y seguimiento estrecho.<br>';
                } else {
                    interpretation += '‚Ä¢ Puede beneficiarse de intervenciones ambulatorias y psicosociales.<br>';
                }
            }

            // Criterio de respuesta (reducci√≥n 20%)
            const responseThreshold = Math.round(scores.total * 0.8);
            interpretation += `‚Ä¢ Una reducci√≥n a ‚â§${responseThreshold} puntos indicar√≠a respuesta significativa al tratamiento.<br>`;

            return interpretation;
        }

        function generateAlerts(scores) {
            const alertsContainer = document.getElementById('alerts-section');
            let alerts = '';

            // Verificar √≠tems individuales de alto riesgo
            const highRiskItems = [];
            const criticalThreshold = 5; // 66% del m√°ximo (7)

            items.forEach(item => {
                const score = responses[item.originalIndex];
                if (score >= criticalThreshold) {
                    highRiskItems.push(`${item.id} - ${item.name}`);
                }
            });

            if (highRiskItems.length > 0) {
                alerts += '<div class="alert high">';
                alerts += '<strong>‚ö†Ô∏è √çtems de Alto Riesgo:</strong><br>';
                alerts += 'Los siguientes √≠tems obtuvieron puntuaciones elevadas (‚â•5):<br>';
                alerts += '‚Ä¢ ' + highRiskItems.join('<br>‚Ä¢ ');
                alerts += '</div>';
            }

            // Alerta de severidad total seg√∫n versi√≥n
            const config = versions[selectedVersion];
            const severeThreshold = config.totalRange.max * 0.75;
            
            if (scores.total >= severeThreshold) {
                alerts += '<div class="alert high">';
                alerts += '<strong>üö® Severidad Cr√≠tica:</strong> Puntuaci√≥n total muy elevada. Requiere evaluaci√≥n inmediata del riesgo y considerar intervenci√≥n intensiva.';
                alerts += '</div>';
            }

            // Alerta de s√≠ntomas positivos severos
            const positiveSevereThreshold = config.positiveRange.max * 0.75;
            if (scores.positive >= positiveSevereThreshold) {
                alerts += '<div class="alert">';
                alerts += '<strong>‚ö†Ô∏è S√≠ntomas Positivos Severos:</strong> Monitorear riesgo de heteroagresividad y adherencia al tratamiento.';
                alerts += '</div>';
            }

            // Informaci√≥n espec√≠fica de versi√≥n abreviada
            if (selectedVersion === 'brief') {
                alerts += '<div class="alert" style="background: #e8f5f3; border-color: #29A98C;">';
                alerts += '<strong>‚ÑπÔ∏è Versi√≥n Abreviada:</strong> Esta evaluaci√≥n utiliz√≥ los 19 √≠tems con mejor rendimiento psicom√©trico. Para evaluaci√≥n comprehensiva, considere aplicar la versi√≥n completa.';
                alerts += '</div>';
            }

            alertsContainer.innerHTML = alerts;
        }

        function exportToPDF() {
            window.print();
        }

        function exportToImage() {
            const resultsCard = document.getElementById('card-results');
            
            // Crear un canvas temporal
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Configurar el canvas
            canvas.width = 800;
            canvas.height = 1000;
            
            // Fondo blanco
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Generar imagen simple con texto
            ctx.fillStyle = '#29A98C';
            ctx.font = 'bold 24px Arial';
            ctx.fillText(`Resultados PANSS - Versi√≥n ${versions[selectedVersion].name}`, 20, 40);
            
            const scores = calculateScore();
            const config = versions[selectedVersion];
            ctx.fillStyle = '#112F33';
            ctx.font = '18px Arial';
            ctx.fillText(`S√≠ntomas Positivos: ${scores.positive}/${config.positiveRange.max}`, 20, 80);
            ctx.fillText(`S√≠ntomas Negativos: ${scores.negative}/${config.negativeRange.max}`, 20, 110);
            ctx.fillText(`Psicopatolog√≠a General: ${scores.general}/${config.generalRange.max}`, 20, 140);
            ctx.fillText(`Puntuaci√≥n Total: ${scores.total}/${config.totalRange.max}`, 20, 170);
            
            // Descargar imagen
            const link = document.createElement('a');
            link.download = `resultados_panss_${selectedVersion}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        function newEvaluation() {
            currentCard = 0;
            responses = {};
            selectedVersion = '';
            
            // Limpiar selecciones
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            
            updateDisplay();
        }

        // Inicializar
        updateDisplay();
    </script>
</body>
</html>
