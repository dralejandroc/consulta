<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PANSS - Escala de Síntomas Positivos y Negativos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #29A98C 0%, #112F33 100%);
            min-height: 100vh;
            padding: 20px;
            color: #112F33;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .card.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-header {
            background: linear-gradient(135deg, #29A98C, #112F33);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .instructions {
            line-height: 1.6;
            color: #112F33;
            margin-bottom: 20px;
        }

        .instructions h3 {
            color: #29A98C;
            margin: 15px 0 10px 0;
        }

        .instructions ul {
            padding-left: 20px;
            margin: 10px 0;
        }

        .version-selector {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .version-button {
            flex: 1;
            background: linear-gradient(135deg, #29A98C, #112F33);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .version-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 169, 140, 0.3);
        }

        .version-info {
            background: #e8f5f3;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #29A98C;
            font-size: 14px;
        }

        .question-number {
            background: linear-gradient(135deg, #29A98C, #112F33);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin: 0 auto 20px auto;
        }

        .question-text {
            font-size: 18px;
            font-weight: 600;
            color: #112F33;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.4;
        }

        .options {
            display: grid;
            gap: 12px;
            margin: 20px 0;
        }

        .option {
            background: #FFF8EE;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .option:hover {
            border-color: #29A98C;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 169, 140, 0.2);
        }

        .option.selected {
            background: linear-gradient(135deg, #29A98C, #112F33);
            color: white;
            border-color: #29A98C;
        }

        .option-number {
            font-weight: bold;
            margin-right: 10px;
        }

        .progress-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #29A98C, #112F33);
            transition: width 0.3s ease;
            z-index: 1000;
        }

        .back-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #29A98C, #112F33);
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 1000;
            display: none;
        }

        .back-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .back-button.show {
            display: block;
        }

        .results-section {
            margin-top: 30px;
        }

        .score-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #29A98C;
        }

        .score-header {
            font-weight: bold;
            font-size: 18px;
            color: #29A98C;
            margin-bottom: 10px;
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #112F33;
        }

        .interpretation {
            background: #e8f5f3;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid #29A98C;
        }

        .alert {
            background: #ffeaa7;
            border: 1px solid #fdcb6e;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            color: #2d3436;
        }

        .alert.high {
            background: #ffcccc;
            border-color: #ff6b6b;
        }

        .export-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .export-button {
            background: linear-gradient(135deg, #29A98C, #112F33);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 150px;
        }

        .export-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(41, 169, 140, 0.3);
        }

        .severity-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        .severity-normal { background: #48bb78; color: white; }
        .severity-mild { background: #f6ad55; color: white; }
        .severity-moderate { background: #ed8936; color: white; }
        .severity-severe { background: #f56565; color: white; }

        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
                margin-bottom: 10px;
            }
            
            .export-buttons, .version-selector {
                flex-direction: column;
            }
            
            .export-button, .version-button {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Card 0: Selección de Versión -->
        <div class="card active" id="card-0">
            <div class="card-header">
                Escala PANSS - Instrucciones para el Profesional
            </div>
            <div class="instructions">
                <h3>Información General</h3>
                <p>La Escala de Síntomas Positivos y Negativos (PANSS) es un instrumento diseñado para evaluar la severidad de síntomas en esquizofrenia y otros trastornos psicóticos.</p>
                
                <h3>Aplicación de la Escala</h3>
                <ul>
                    <li><strong>Administración:</strong> Heteroaplicada por profesional capacitado</li>
                    <li><strong>Técnica:</strong> Entrevista semiestructurada</li>
                    <li><strong>Período de evaluación:</strong> Síntomas de la última semana</li>
                </ul>

                <h3>Puntuación</h3>
                <p>Cada ítem se califica en una escala de 7 puntos:</p>
                <ul>
                    <li>1 = Ausente | 2 = Mínimo | 3 = Leve | 4 = Moderado</li>
                    <li>5 = Moderado-severo | 6 = Severo | 7 = Extremo</li>
                </ul>

                <h3>Consideraciones Importantes</h3>
                <ul>
                    <li>Base su evaluación en la entrevista clínica y observación del comportamiento</li>
                    <li>Considere tanto la frecuencia como la intensidad de los síntomas</li>
                    <li>Los resultados no son visibles para el paciente</li>
                    <li>Una reducción del 20% en el puntaje total indica respuesta al tratamiento</li>
                </ul>

                <h3>Seleccione la Versión a Aplicar</h3>
                
                <div class="version-info">
                    <strong>Versión Completa (30 ítems)</strong><br>
                    • Tiempo: 30-40 minutos<br>
                    • Evaluación comprehensiva de todos los dominios sintomáticos<br>
                    • Estándar de oro para evaluación clínica e investigación
                </div>

                <div class="version-info">
                    <strong>Versión Abreviada (19 ítems)</strong><br>
                    • Tiempo: 15-20 minutos<br>
                    • Ítems seleccionados por Teoría de Respuesta a los Ítems<br>
                    • Correlación alta con versión completa (r > 0.93)<br>
                    • Útil para seguimiento y monitoreo frecuente
                </div>
            </div>
            
            <div class="version-selector">
                <button class="version-button" onclick="selectVersion('full')">
                    <div style="font-size: 18px; margin-bottom: 8px;">📋 Versión Completa</div>
                    <div style="font-size: 14px;">30 ítems | 30-40 min</div>
                </button>
                <button class="version-button" onclick="selectVersion('brief')">
                    <div style="font-size: 18px; margin-bottom: 8px;">⚡ Versión Abreviada</div>
                    <div style="font-size: 14px;">19 ítems | 15-20 min</div>
                </button>
            </div>
        </div>

        <!-- Cards dinámicas se generarán aquí -->
        
        <!-- Card de Resultados -->
        <div class="card" id="card-results">
            <div class="card-header">
                Resultados de la Evaluación PANSS
            </div>
            <div class="results-section">
                <div class="score-card">
                    <div class="score-header">Síntomas Positivos</div>
                    <div class="score-value" id="positive-score">0</div>
                    <div id="positive-interpretation"></div>
                </div>
                
                <div class="score-card">
                    <div class="score-header">Síntomas Negativos</div>
                    <div class="score-value" id="negative-score">0</div>
                    <div id="negative-interpretation"></div>
                </div>
                
                <div class="score-card">
                    <div class="score-header">Psicopatología General</div>
                    <div class="score-value" id="general-score">0</div>
                    <div id="general-interpretation"></div>
                </div>
                
                <div class="score-card">
                    <div class="score-header">Puntuación Total PANSS</div>
                    <div class="score-value" id="total-score">0</div>
                    <div id="total-interpretation"></div>
                </div>

                <div class="interpretation">
                    <h3 style="color: #29A98C; margin-bottom: 15px;">Interpretación Clínica</h3>
                    <div id="clinical-interpretation"></div>
                </div>

                <div id="alerts-section"></div>
                
                <div class="export-buttons">
                    <button class="export-button" onclick="exportToPDF()">📄 Exportar a PDF</button>
                    <button class="export-button" onclick="exportToImage()">📷 Capturar Imagen</button>
                    <button class="export-button" onclick="newEvaluation()">🔄 Nueva Evaluación</button>
                </div>
            </div>
        </div>
    </div>

    <div class="progress-bar" id="progress-bar"></div>
    <button class="back-button" id="back-button" onclick="previousCard()">←</button>

    <script>
        let currentCard = 0;
        let responses = {};
        let selectedVersion = '';
        let totalQuestions = 30;
        let items = [];

        // Configuración de versiones
        const versions = {
            full: {
                name: 'Completa',
                items: 30,
                positiveItems: [1, 2, 3, 4, 5, 6, 7],
                negativeItems: [8, 9, 10, 11, 12, 13, 14],
                generalItems: [15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30],
                positiveRange: { min: 7, max: 49 },
                negativeRange: { min: 7, max: 49 },
                generalRange: { min: 16, max: 112 },
                totalRange: { min: 30, max: 210 }
            },
            brief: {
                name: 'Abreviada',
                items: 19,
                positiveItems: [1, 2, 3, 4, 5, 6], // P1-P6 (excluye P7)
                negativeItems: [8, 9, 10, 11, 13, 14], // N1-N4, N6-N7 (excluye N5)
                generalItems: [18, 20, 21, 22, 23, 27, 28], // G4, G6, G7, G8, G9, G13, G14
                positiveRange: { min: 6, max: 42 },
                negativeRange: { min: 6, max: 42 },
                generalRange: { min: 7, max: 49 },
                totalRange: { min: 19, max: 133 }
            }
        };

        // Definición de todos los ítems PANSS
        const allItems = {
            1: { id: 'P1', name: 'Delirios', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de creencias delirantes',
                2: 'Mínimo - Dudosa patología; puede estar en el rango superior de lo normal',
                3: 'Leve - Presencia de una o dos creencias delirantes vagas o poco sistematizadas',
                4: 'Moderado - Presencia de un sistema delirante bien organizado pero limitado',
                5: 'Moderado-severo - Presencia de múltiples delirios bien organizados',
                6: 'Severo - Presencia de sistema delirante estable y elaborado con contenido bizarro',
                7: 'Extremo - Pensamiento dominado por delirios incapacitantes y/o peligrosos'
            }},
            2: { id: 'P2', name: 'Desorganización Conceptual', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de desorganización formal del pensamiento',
                2: 'Mínimo - Pensamiento un tanto vago o irrelevante',
                3: 'Leve - Ocasionalmente pierde el hilo o las ideas no están bien relacionadas',
                4: 'Moderado - Pensamiento frecuentemente vago, tangencial o circumstancial',
                5: 'Moderado-severo - Pensamiento generalmente difícil de seguir',
                6: 'Severo - No hay conexión lógica entre ideas; habla incoherente',
                7: 'Extremo - Incoherencia severa o mutismo'
            }},
            3: { id: 'P3', name: 'Comportamiento Alucinatorio', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de alucinaciones',
                2: 'Mínimo - Dudosa patología; puede estar en el rango superior de lo normal',
                3: 'Leve - Una o dos alucinaciones claramente formadas de cualquier tipo',
                4: 'Moderado - Alucinaciones ocasionales o algunas persistentes',
                5: 'Moderado-severo - Alucinaciones persistentes a lo largo del día',
                6: 'Severo - Alucinaciones presentes casi continuamente',
                7: 'Extremo - Totalmente preocupado por alucinaciones incapacitantes'
            }},
            4: { id: 'P4', name: 'Excitación', type: 'positive', descriptions: {
                1: 'Ausente - Comportamiento natural; actividad apropiada',
                2: 'Mínimo - Ocasionalmente elevado, animado o impaciente',
                3: 'Leve - Claramente elevado, habla rápida, ocasionalmente ruidoso',
                4: 'Moderado - Excitación significativa; habla rápida e hiperactividad ocasional',
                5: 'Moderado-severo - Marcadamente excitado; habla acelerada, hiperactividad',
                6: 'Severo - Significativamente excitado e hiperactivo; puede ser agresivo',
                7: 'Extremo - Excitación extrema; habla acelerada incoherente o hiperactividad'
            }},
            5: { id: 'P5', name: 'Grandiosidad', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de autoestima exagerada',
                2: 'Mínimo - Autoestima algo elevada o jactanciosa',
                3: 'Leve - Exagerada autoestima o reclamos sin garantía',
                4: 'Moderado - Marcada grandiosidad con ideas grandiosas superficiales',
                5: 'Moderado-severo - Grandiosidad severa con delirios francos de grandeza',
                6: 'Severo - Pensamiento dominado por delirios grandiosos organizados',
                7: 'Extremo - Grandiosidad extrema con delirios incapacitantes'
            }},
            6: { id: 'P6', name: 'Suspicacia/Persecución', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de desconfianza, suspicacia o ideas persecutorias',
                2: 'Mínimo - Vaga desconfianza o dudas sobre las motivaciones de otros',
                3: 'Leve - Distintivamente suspicaz; doble sentido en comentarios neutrales',
                4: 'Moderado - Marcadamente suspicaz; ideas de referencia persistentes',
                5: 'Moderado-severo - Marcadas ideas de persecución sin delirios claros',
                6: 'Severo - Delirios persecutorios claramente formados pero limitados',
                7: 'Extremo - Delirios persecutorios severos dominan la presentación'
            }},
            7: { id: 'P7', name: 'Hostilidad', type: 'positive', descriptions: {
                1: 'Ausente - No hay evidencia de cólera, irritabilidad, resentimiento u hostilidad',
                2: 'Mínimo - Indirecta o controlada irritabilidad',
                3: 'Leve - Ocasional irritabilidad y resentimiento',
                4: 'Moderado - Significativa irritabilidad y actitud francamente hostil',
                5: 'Moderado-severo - Marcadamente hostil; frecuente irritabilidad y cólera',
                6: 'Severo - Intensa hostilidad; comportamiento amenazante o agresivo',
                7: 'Extremo - Cólera extrema con hostilidad generalizada e incontrolable'
            }},
            8: { id: 'N1', name: 'Embotamiento Afectivo', type: 'negative', descriptions: {
                1: 'Ausente - Rango emocional apropiado y modulado',
                2: 'Mínimo - Expresión emocional ligeramente disminuida',
                3: 'Leve - Rango emocional claramente reducido; expresión facial infrequente',
                4: 'Moderado - Rango afectivo notablemente reducido',
                5: 'Moderado-severo - Marcada reducción en expresión emocional',
                6: 'Severo - Expresión emocional severamente reducida',
                7: 'Extremo - Virtualmente sin expresión emocional'
            }},
            9: { id: 'N2', name: 'Retraimiento Emocional', type: 'negative', descriptions: {
                1: 'Ausente - Apropiada participación emocional',
                2: 'Mínimo - Involucración emocional ligeramente reducida',
                3: 'Leve - Ocasionalmente parece indiferente o distante',
                4: 'Moderado - Marcada tendencia a mantenerse emocionalmente separado',
                5: 'Moderado-severo - Claramente distante y retraído emocionalmente',
                6: 'Severo - Marcadamente retraído emocionalmente e inaccesible',
                7: 'Extremo - Aparenta estar totalmente retraído emocionalmente'
            }},
            10: { id: 'N3', name: 'Contacto Pobre', type: 'negative', descriptions: {
                1: 'Ausente - Contacto interpersonal natural y apropiado',
                2: 'Mínimo - Contacto interpersonal ligeramente reducido',
                3: 'Leve - Moderada disminución en involucramiento o tono',
                4: 'Moderado - Poco natural, forzado o tono superficial',
                5: 'Moderado-severo - Claramente inadecuado, constante falta de involucramiento',
                6: 'Severo - Marcado déficit con mínimo contacto interpersonal',
                7: 'Extremo - Extremo déficit, paciente evita, rechaza o elude contacto'
            }},
            11: { id: 'N4', name: 'Retraimiento Social Pasivo/Apático', type: 'negative', descriptions: {
                1: 'Ausente - Involucramiento social apropiado',
                2: 'Mínimo - Ocasional disminución en involucramiento social',
                3: 'Leve - Presente pero mantiene algún interés en actividades sociales',
                4: 'Moderado - Moderada disminución en interés y iniciativa social',
                5: 'Moderado-severo - Marcada falta de involucramiento social',
                6: 'Severo - Mínimo interés y pocas actividades sociales',
                7: 'Extremo - Ausencia virtual de involucramiento social'
            }},
            12: { id: 'N5', name: 'Dificultad en el Pensamiento Abstracto', type: 'negative', descriptions: {
                1: 'Ausente - No hay dificultad en el pensamiento abstracto',
                2: 'Mínimo - Ocasional dificultad con abstracciones complejas',
                3: 'Leve - Tendencia al pensamiento concreto; dificultad con conceptos',
                4: 'Moderado - Considerablemente abstracto pensamiento concreto, limitado',
                5: 'Moderado-severo - Marcado pensamiento concreto; dificultad con abstracciones',
                6: 'Severo - Pensamiento concretístico; sin conceptos abstractos',
                7: 'Extremo - Pensamiento sólo concreto; comprensión limitada de palabras simples'
            }},
            13: { id: 'N6', name: 'Ausencia de Espontaneidad y Fluidez en la Conversación', type: 'negative', descriptions: {
                1: 'Ausente - Conversación natural y fluida',
                2: 'Mínimo - Ligera reducción en espontaneidad de la conversación',
                3: 'Leve - Ocasional prompting necesario para mantener conversación',
                4: 'Moderado - Marcada reducción en fluidez; frecuentes prompts necesarios',
                5: 'Moderado-severo - Marcada falta de espontaneidad; respuestas breves',
                6: 'Severo - Pocas respuestas espontáneas; respuestas limitadas',
                7: 'Extremo - Virtualmente sin espontaneidad; respuestas de una palabra'
            }},
            14: { id: 'N7', name: 'Pensamiento Estereotipado', type: 'negative', descriptions: {
                1: 'Ausente - No hay evidencia de pensamiento estereotipado',
                2: 'Mínimo - Ocasional uso de frases repetitivas o ideas clichés',
                3: 'Leve - Alguna tendencia a repetición en temas o perspectivas',
                4: 'Moderado - Marcada tendencia a repetir temas con pensamiento rígido',
                5: 'Moderado-severo - Frecuente repetición de ideas, frases o palabras',
                6: 'Severo - Pensamiento restringido a pocas ideas estereotipadas',
                7: 'Extremo - Pensamiento limitado a una o dos ideas estereotipadas'
            }},
            15: { id: 'G1', name: 'Preocupación Somática', type: 'general', descriptions: {
                1: 'Ausente - No reporta problemas físicos o de salud',
                2: 'Mínimo - Vaga y ocasional preocupación por problemas de salud',
                3: 'Leve - Ocasional preocupación por problemas de salud o corporales',
                4: 'Moderado - Frecuentes quejas sobre problemas de salud o físicos',
                5: 'Moderado-severo - Preocupación muy frecuente por problemas de salud',
                6: 'Severo - Preocupación dominante por problemas de salud',
                7: 'Extremo - Totalmente preocupado por quejas de salud incapacitantes'
            }},
            16: { id: 'G2', name: 'Ansiedad', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de nerviosismo, preocupación o inquietud',
                2: 'Mínimo - Dudosa evidencia de ansiedad',
                3: 'Leve - Claramente nervioso e inquieto pero puede controlarse',
                4: 'Moderado - Significativa ansiedad; dificultad para controlarla',
                5: 'Moderado-severo - Marcada ansiedad; interfiere significativamente',
                6: 'Severo - Ansiedad severa; dominante en presentación clínica',
                7: 'Extremo - Ansiedad incapacitante; dominante en todas las áreas'
            }},
            17: { id: 'G3', name: 'Sentimientos de Culpa', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de culpa, vergüenza o auto-reproches',
                2: 'Mínimo - Vaga o dudosa evidencia de culpa',
                3: 'Leve - Ocasional culpa o auto-reproches por actos menores',
                4: 'Moderado - Frecuentes sentimientos de culpa; preocupación por errores pasados',
                5: 'Moderado-severo - Marcados sentimientos de culpa asociados con auto-depreciación',
                6: 'Severo - Intensos sentimientos de culpa con ideas delirantes',
                7: 'Extremo - Agobiado por delirios de culpa incapacitantes'
            }},
            18: { id: 'G4', name: 'Tensión', type: 'general', descriptions: {
                1: 'Ausente - Relajado y calmo',
                2: 'Mínimo - Ligeramente tenso; ocasionalmente inquieto',
                3: 'Leve - Moderada tensión; ocasional inquietud o impaciencia',
                4: 'Moderado - Significativa tensión; dificultad para relajarse',
                5: 'Moderado-severo - Marcada tensión; inquietud motora notable',
                6: 'Severo - Tensa al extremo; inquietud prominente',
                7: 'Extremo - Tensión extrema; inquietud constante e incapacitante'
            }},
            19: { id: 'G5', name: 'Manierismos y Posturas', type: 'general', descriptions: {
                1: 'Ausente - No hay evidencia de movimientos o posturas inusuales',
                2: 'Mínimo - Ligera rigidez postural o movimientos inusuales poco frecuentes',
                3: 'Leve - Ocasionales movimientos inusuales o rigidez postural',
                4: 'Moderado - Frecuentes movimientos peculiares o posturas inusuales',
                5: 'Moderado-severo - Marcados manierismos; posturas bizarras ocasionales',
                6: 'Severo - Manierismos frecuentes; posturas bizarras persistentes',
                7: 'Extremo - Comportamiento bizarro constante; posturas catatónicas'
            }},
            20: { id: 'G6', name: 'Depresión', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de tristeza, desaliento o pesimismo',
                2: 'Mínimo - Vagos y raros períodos de tristeza',
                3: 'Leve - Triste pero fácilmente animado; sólo superficialmente deprimido',
                4: 'Moderado - Moderadamente deprimido; triste la mayor parte del tiempo',
                5: 'Moderado-severo - Marcadamente deprimido; claramente miserable',
                6: 'Severo - Severamente deprimido; desesperanzado y desalentado',
                7: 'Extremo - Depresión extrema; miserable constantemente'
            }},
            21: { id: 'G7', name: 'Retardo Motor', type: 'general', descriptions: {
                1: 'Ausente - Actividad motora normal en todo aspecto',
                2: 'Mínimo - Ligera pero noticiable disminución en velocidad motora',
                3: 'Leve - Claramente ralentizado pero no más que ligero impedimento',
                4: 'Moderado - Moderadamente ralentizado; movimientos definidamente impedidos',
                5: 'Moderado-severo - Marcadamente ralentizado; todas las acciones muy lentas',
                6: 'Severo - Movimientos extremadamente lentos; actividad mínima',
                7: 'Extremo - Virtualmente inmóvil; apenas perceptible actividad motora'
            }},
            22: { id: 'G8', name: 'Falta de Cooperación', type: 'general', descriptions: {
                1: 'Ausente - Comportamiento natural y cooperativo',
                2: 'Mínimo - Excesiva formalidad; cooperación ligeramente reluctante',
                3: 'Leve - Alguna evidencia de resentimiento, irritación o impaciencia',
                4: 'Moderado - Moderada falta de cooperación; respuestas cortas e irritables',
                5: 'Moderado-severo - Marcadamente no cooperativo; responde mal',
                6: 'Severo - Altamente no cooperativo; respuestas hostiles o rechazantes',
                7: 'Extremo - Rehúsa completamente cooperar; hostil y agresivo'
            }},
            23: { id: 'G9', name: 'Contenidos Inusuales del Pensamiento', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de pensamiento inusual, extraño o bizarro',
                2: 'Mínimo - Ligera peculiaridad en contenido del pensamiento',
                3: 'Leve - Ideas claramente extrañas o contenido del pensamiento inusual',
                4: 'Moderado - Ideas distintivamente inusuales o contenido bizarro del pensamiento',
                5: 'Moderado-severo - Marcadamente bizarro contenido del pensamiento',
                6: 'Severo - Extremadamente bizarro pensamiento con contenido absurdo',
                7: 'Extremo - Pensamiento repleto de ideas absurdas e incoherentes'
            }},
            24: { id: 'G10', name: 'Desorientación', type: 'general', descriptions: {
                1: 'Ausente - Totalmente orientado en las tres esferas',
                2: 'Mínimo - Ocasional y ligera confusión sobre el tiempo y lugar',
                3: 'Leve - Moderada confusión; claramente desorientado en una esfera',
                4: 'Moderado - Significativa confusión; desorientado en dos esferas',
                5: 'Moderado-severo - Marcada confusión; severamente desorientado',
                6: 'Severo - Extrema confusión y desorientación en las tres esferas',
                7: 'Extremo - No tiene orientación; totalmente confundido'
            }},
            25: { id: 'G11', name: 'Atención Deficiente', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de atención deficiente',
                2: 'Mínimo - Limitada capacidad para enfocar atención; fácilmente distraíble',
                3: 'Leve - Dificultad para enfocar atención; concentración pobre',
                4: 'Moderado - Sólo puede mantener atención brevemente; muy distraíble',
                5: 'Moderado-severo - Marcada dificultad para dirigir o mantener atención',
                6: 'Severo - Sin foco sostenido de atención; extrema distracción',
                7: 'Extremo - Sin capacidad dirigida de atención; totalmente distraído'
            }},
            26: { id: 'G12', name: 'Ausencia de Juicio e Insight', type: 'general', descriptions: {
                1: 'Ausente - Reconoce enfermedad; comprende necesidad de tratamiento',
                2: 'Mínimo - Ligera disminución en awareness de enfermedad',
                3: 'Leve - Reconoce enfermedad pero culpa a otros factores externos',
                4: 'Moderado - Insight fluctuante; algún reconocimiento de enfermedad',
                5: 'Moderado-severo - Deficiente insight; reconoce problemas vagamente',
                6: 'Severo - Sin awareness de enfermedad; niega claramente síntomas',
                7: 'Extremo - Enfáticamente niega enfermedad pasada y presente'
            }},
            27: { id: 'G13', name: 'Perturbación de la Volición', type: 'general', descriptions: {
                1: 'Ausente - Comportamiento natural con voluntad apropiada',
                2: 'Mínimo - Ocasional indecisión en el curso de actividades normales',
                3: 'Leve - Distintas dificultades en procesos de toma de decisiones',
                4: 'Moderado - Disturbed volition; dificultad en iniciar y controlar actividad',
                5: 'Moderado-severo - Marcada ambivalencia; actividad fragmentada',
                6: 'Severo - Fuerte ambivalencia; actividad bloqueada o comportamiento inapropriado',
                7: 'Extremo - Sin control volitivo; incapaz de iniciar o regular actividad'
            }},
            28: { id: 'G14', name: 'Control Deficiente de los Impulsos', type: 'general', descriptions: {
                1: 'Ausente - Impulsos apropiadamente controlados',
                2: 'Mínimo - Ocasionales impulsos difíciles de controlar',
                3: 'Leve - Dificultades en control de impulsos resultan en comportamiento menor',
                4: 'Moderado - Dificultades significativas en control de impulsos',
                5: 'Moderado-severo - Deficiente control de impulsos; episodios impulsivos ocasionales',
                6: 'Severo - Impulsos frecuentemente mal controlados; episodios repetidos',
                7: 'Extremo - Sin control de impulsos; episodios peligrosos constantes'
            }},
            29: { id: 'G15', name: 'Preocupación', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de preocupación con pensamientos particulares',
                2: 'Mínimo - Ocasionalmente absorto en pensamientos; fácilmente dirigible',
                3: 'Leve - Frecuentemente preocupado por pensamientos recurrentes',
                4: 'Moderado - Frecuente preocupación; dificultad para concentrarse',
                5: 'Moderado-severo - Marcada preocupación; interferencia significativa',
                6: 'Severo - Intensamente preocupado; difícil dirigir hacia otros temas',
                7: 'Extremo - Totalmente absorto; imposible dirigir a otros temas'
            }},
            30: { id: 'G16', name: 'Evitación Social Activa', type: 'general', descriptions: {
                1: 'Ausente - Sin evidencia de evitación social',
                2: 'Mínimo - Ocasional irritación por intrusión social',
                3: 'Leve - Preferencia por estar solo; evita situaciones sociales',
                4: 'Moderado - Marcada preferencia por actividades solitarias',
                5: 'Moderado-severo - Busca aislamiento; evita activamente actividad social',
                6: 'Severo - Altamente intolerante de situaciones sociales',
                7: 'Extremo - Fuerza aislamiento completo; rehúsa interacción social'
            }}
        };

        function selectVersion(version) {
            selectedVersion = version;
            const config = versions[version];
            totalQuestions = config.items;
            
            // Generar lista de ítems para la versión seleccionada
            items = [];
            
            // Añadir ítems positivos
            config.positiveItems.forEach(itemNum => {
                items.push({ ...allItems[itemNum], originalIndex: itemNum });
            });
            
            // Añadir ítems negativos
            config.negativeItems.forEach(itemNum => {
                items.push({ ...allItems[itemNum], originalIndex: itemNum });
            });
            
            // Añadir ítems generales
            config.generalItems.forEach(itemNum => {
                items.push({ ...allItems[itemNum], originalIndex: itemNum });
            });

            // Generar cards dinámicamente
            generateItemCards();
            
            // Avanzar a la primera pregunta
            currentCard = 1;
            updateDisplay();
        }

        function generateItemCards() {
            const container = document.querySelector('.container');
            
            // Remover cards existentes (excepto la inicial y resultados)
            const existingCards = container.querySelectorAll('.card:not(#card-0):not(#card-results)');
            existingCards.forEach(card => card.remove());

            // Generar nuevas cards
            items.forEach((item, index) => {
                const cardNumber = index + 1;
                const cardHTML = `
                    <div class="card" id="card-${cardNumber}">
                        <div class="question-number">${item.id}</div>
                        <div class="card-header">${item.type === 'positive' ? 'Síntomas Positivos' : 
                                                 item.type === 'negative' ? 'Síntomas Negativos' : 'Psicopatología General'}</div>
                        <div class="question-text">${item.name}</div>
                        <div class="options">
                            ${Object.entries(item.descriptions).map(([score, description]) => `
                                <div class="option" onclick="selectOption(${cardNumber}, ${score})">
                                    <span class="option-number">${score}</span>${description}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
                
                // Insertar antes del card de resultados
                const resultsCard = document.getElementById('card-results');
                resultsCard.insertAdjacentHTML('beforebegin', cardHTML);
            });
        }

        function updateDisplay() {
            // Ocultar todas las tarjetas
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('active');
            });

            // Mostrar tarjeta actual
            let currentCardElement;
            if (currentCard === 0) {
                currentCardElement = document.getElementById('card-0');
            } else if (currentCard > totalQuestions) {
                currentCardElement = document.getElementById('card-results');
            } else {
                currentCardElement = document.getElementById(`card-${currentCard}`);
            }
            
            if (currentCardElement) {
                currentCardElement.classList.add('active');
            }

            // Actualizar barra de progreso
            const progress = currentCard === 0 ? 0 : (currentCard / (totalQuestions + 1)) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;

            // Mostrar/ocultar botón de regresar
            const backButton = document.getElementById('back-button');
            if (currentCard > 0 && currentCard <= totalQuestions) {
                backButton.classList.add('show');
            } else {
                backButton.classList.remove('show');
            }
        }

        function selectOption(questionNumber, value) {
            const itemIndex = questionNumber - 1;
            const originalIndex = items[itemIndex].originalIndex;
            responses[originalIndex] = value;
            
            // Marcar opción seleccionada
            const currentCardElement = document.getElementById(`card-${currentCard}`);
            currentCardElement.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');

            // Auto-avance después de 150ms
            setTimeout(() => {
                nextCard();
            }, 150);
        }

        function nextCard() {
            if (currentCard < totalQuestions) {
                currentCard++;
                updateDisplay();
            } else if (currentCard === totalQuestions) {
                showResults();
            }
        }

        function previousCard() {
            if (currentCard > 1) {
                currentCard--;
                updateDisplay();
            } else if (currentCard === 1) {
                currentCard = 0;
                updateDisplay();
            }
        }

        function calculateScore() {
            const config = versions[selectedVersion];
            let positiveScore = 0;
            let negativeScore = 0;
            let generalScore = 0;

            // Calcular puntuaciones según la versión
            config.positiveItems.forEach(itemIndex => {
                positiveScore += responses[itemIndex] || 1;
            });

            config.negativeItems.forEach(itemIndex => {
                negativeScore += responses[itemIndex] || 1;
            });

            config.generalItems.forEach(itemIndex => {
                generalScore += responses[itemIndex] || 1;
            });

            const totalScore = positiveScore + negativeScore + generalScore;

            return {
                positive: positiveScore,
                negative: negativeScore,
                general: generalScore,
                total: totalScore
            };
        }

        function getInterpretation(scores) {
            const config = versions[selectedVersion];
            
            const interpretations = {
                positive: getSeverityLevel(scores.positive, config.positiveRange.min, config.positiveRange.max),
                negative: getSeverityLevel(scores.negative, config.negativeRange.min, config.negativeRange.max),
                general: getSeverityLevel(scores.general, config.generalRange.min, config.generalRange.max),
                total: getSeverityLevel(scores.total, config.totalRange.min, config.totalRange.max)
            };

            return interpretations;
        }

        function getSeverityLevel(score, minScore, maxScore) {
            const percentage = ((score - minScore) / (maxScore - minScore)) * 100;
            
            if (percentage <= 25) {
                return { level: 'Mínimo', class: 'severity-normal', description: 'Síntomas ausentes o mínimos' };
            } else if (percentage <= 50) {
                return { level: 'Leve', class: 'severity-mild', description: 'Síntomas leves presentes' };
            } else if (percentage <= 75) {
                return { level: 'Moderado', class: 'severity-moderate', description: 'Síntomas moderados significativos' };
            } else {
                return { level: 'Severo', class: 'severity-severe', description: 'Síntomas severos prominentes' };
            }
        }

        function showResults() {
            currentCard = totalQuestions + 1;
            const scores = calculateScore();
            const interpretations = getInterpretation(scores);
            const config = versions[selectedVersion];

            // Actualizar puntuaciones
            document.getElementById('positive-score').textContent = `${scores.positive}/${config.positiveRange.max}`;
            document.getElementById('negative-score').textContent = `${scores.negative}/${config.negativeRange.max}`;
            document.getElementById('general-score').textContent = `${scores.general}/${config.generalRange.max}`;
            document.getElementById('total-score').textContent = `${scores.total}/${config.totalRange.max}`;

            // Actualizar interpretaciones
            document.getElementById('positive-interpretation').innerHTML = 
                `<span class="severity-indicator ${interpretations.positive.class}">${interpretations.positive.level}</span> - ${interpretations.positive.description}`;
            
            document.getElementById('negative-interpretation').innerHTML = 
                `<span class="severity-indicator ${interpretations.negative.class}">${interpretations.negative.level}</span> - ${interpretations.negative.description}`;
            
            document.getElementById('general-interpretation').innerHTML = 
                `<span class="severity-indicator ${interpretations.general.class}">${interpretations.general.level}</span> - ${interpretations.general.description}`;
            
            document.getElementById('total-interpretation').innerHTML = 
                `<span class="severity-indicator ${interpretations.total.class}">${interpretations.total.level}</span> - ${interpretations.total.description}`;

            // Interpretación clínica detallada
            const clinicalInterpretation = generateClinicalInterpretation(scores, interpretations);
            document.getElementById('clinical-interpretation').innerHTML = clinicalInterpretation;

            // Generar alertas
            generateAlerts(scores);

            updateDisplay();
        }

        function generateClinicalInterpretation(scores, interpretations) {
            const config = versions[selectedVersion];
            let interpretation = `<strong>Versión ${config.name} - Perfil Sintomatológico:</strong><br>`;
            
            // Análisis dimensional
            if (scores.positive > scores.negative) {
                interpretation += '• Predominio de síntomas positivos. Sugiere presencia de alucinaciones, delirios o desorganización del pensamiento.<br>';
            } else if (scores.negative > scores.positive) {
                interpretation += '• Predominio de síntomas negativos. Indica déficits en el funcionamiento emocional, social y cognitivo.<br>';
            } else {
                interpretation += '• Perfil mixto con síntomas positivos y negativos equilibrados.<br>';
            }

            // Severidad global
            const totalPercentage = ((scores.total - config.totalRange.min) / (config.totalRange.max - config.totalRange.min)) * 100;
            interpretation += `• Severidad global: ${totalPercentage.toFixed(1)}% del rango máximo.<br>`;

            // Criterios de respuesta al tratamiento
            interpretation += '<br><strong>Consideraciones para el Tratamiento:</strong><br>';
            
            if (selectedVersion === 'brief') {
                interpretation += '• Mini-PANSS correlaciona altamente con PANSS-30 (r > 0.93).<br>';
                if (scores.total >= 90) {
                    interpretation += '• Paciente candidato para intervención intensiva.<br>';
                } else if (scores.total >= 60) {
                    interpretation += '• Requerirá tratamiento farmacológico y seguimiento estrecho.<br>';
                } else {
                    interpretation += '• Puede beneficiarse de intervenciones ambulatorias y psicosociales.<br>';
                }
            } else {
                if (scores.total >= 120) {
                    interpretation += '• Paciente candidato para intervención intensiva y posible hospitalización.<br>';
                } else if (scores.total >= 90) {
                    interpretation += '• Requerirá tratamiento farmacológico y seguimiento estrecho.<br>';
                } else {
                    interpretation += '• Puede beneficiarse de intervenciones ambulatorias y psicosociales.<br>';
                }
            }

            // Criterio de respuesta (reducción 20%)
            const responseThreshold = Math.round(scores.total * 0.8);
            interpretation += `• Una reducción a ≤${responseThreshold} puntos indicaría respuesta significativa al tratamiento.<br>`;

            return interpretation;
        }

        function generateAlerts(scores) {
            const alertsContainer = document.getElementById('alerts-section');
            let alerts = '';

            // Verificar ítems individuales de alto riesgo
            const highRiskItems = [];
            const criticalThreshold = 5; // 66% del máximo (7)

            items.forEach(item => {
                const score = responses[item.originalIndex];
                if (score >= criticalThreshold) {
                    highRiskItems.push(`${item.id} - ${item.name}`);
                }
            });

            if (highRiskItems.length > 0) {
                alerts += '<div class="alert high">';
                alerts += '<strong>⚠️ Ítems de Alto Riesgo:</strong><br>';
                alerts += 'Los siguientes ítems obtuvieron puntuaciones elevadas (≥5):<br>';
                alerts += '• ' + highRiskItems.join('<br>• ');
                alerts += '</div>';
            }

            // Alerta de severidad total según versión
            const config = versions[selectedVersion];
            const severeThreshold = config.totalRange.max * 0.75;
            
            if (scores.total >= severeThreshold) {
                alerts += '<div class="alert high">';
                alerts += '<strong>🚨 Severidad Crítica:</strong> Puntuación total muy elevada. Requiere evaluación inmediata del riesgo y considerar intervención intensiva.';
                alerts += '</div>';
            }

            // Alerta de síntomas positivos severos
            const positiveSevereThreshold = config.positiveRange.max * 0.75;
            if (scores.positive >= positiveSevereThreshold) {
                alerts += '<div class="alert">';
                alerts += '<strong>⚠️ Síntomas Positivos Severos:</strong> Monitorear riesgo de heteroagresividad y adherencia al tratamiento.';
                alerts += '</div>';
            }

            // Información específica de versión abreviada
            if (selectedVersion === 'brief') {
                alerts += '<div class="alert" style="background: #e8f5f3; border-color: #29A98C;">';
                alerts += '<strong>ℹ️ Versión Abreviada:</strong> Esta evaluación utilizó los 19 ítems con mejor rendimiento psicométrico. Para evaluación comprehensiva, considere aplicar la versión completa.';
                alerts += '</div>';
            }

            alertsContainer.innerHTML = alerts;
        }

        function exportToPDF() {
            window.print();
        }

        function exportToImage() {
            const resultsCard = document.getElementById('card-results');
            
            // Crear un canvas temporal
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Configurar el canvas
            canvas.width = 800;
            canvas.height = 1000;
            
            // Fondo blanco
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Generar imagen simple con texto
            ctx.fillStyle = '#29A98C';
            ctx.font = 'bold 24px Arial';
            ctx.fillText(`Resultados PANSS - Versión ${versions[selectedVersion].name}`, 20, 40);
            
            const scores = calculateScore();
            const config = versions[selectedVersion];
            ctx.fillStyle = '#112F33';
            ctx.font = '18px Arial';
            ctx.fillText(`Síntomas Positivos: ${scores.positive}/${config.positiveRange.max}`, 20, 80);
            ctx.fillText(`Síntomas Negativos: ${scores.negative}/${config.negativeRange.max}`, 20, 110);
            ctx.fillText(`Psicopatología General: ${scores.general}/${config.generalRange.max}`, 20, 140);
            ctx.fillText(`Puntuación Total: ${scores.total}/${config.totalRange.max}`, 20, 170);
            
            // Descargar imagen
            const link = document.createElement('a');
            link.download = `resultados_panss_${selectedVersion}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        function newEvaluation() {
            currentCard = 0;
            responses = {};
            selectedVersion = '';
            
            // Limpiar selecciones
            document.querySelectorAll('.option').forEach(option => {
                option.classList.remove('selected');
            });
            
            updateDisplay();
        }

        // Inicializar
        updateDisplay();
    </script>
</body>
</html>
